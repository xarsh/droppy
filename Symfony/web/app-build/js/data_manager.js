define(["jQuery","Underscore","Backbone","collections/event_list","views/timeline/timeline","collections/user_list","views/general/user_list","event_manager","bootstrap","helpers/assets"],function(e,t,n,r,i,s,o,u,a,f){var l=function(){this.initialize()};return l.prototype={initialize:function(){this.timeline=new r,t.extend(this.timeline,{routeList:{read:"droppy_event_ajax_timeline"}}),new i(this.timeline),a.bootstrappedTimeline&&this.timeline.setFromJSON(a.bootstrappedTimeline),this.initRecommendedUsers(),this.initEvents()},initEvents:function(){u.on("drop",this.drop,this),u.on("undrop",this.undrop,this),u.on("eventUpdate",this.addToTimeline,this),u.on("eventRemoved",this.removeFromTimeline,this)},addToTimeline:function(e){this.timeline.add(e)},initRecommendedUsers:function(){this.recommendedUsers=new s,t.extend(this.recommendedUsers,{routeList:{read:"droppy_user_ajax_isobeselected_users"},comparator:function(e){return e.get("droppersNumber")}}),new o({userList:this.recommendedUsers,templateName:"single_user_small",el:"div.recommended_users"})},drop:function(e,t,n){var i=this;t.children("img").attr("src",f.staticAsset("img/loading.gif")),e.set("loading",!0),e.drop({success:function(i){t.addClass(n?"dropping":"in"),t.children("img").attr("src",f.staticAsset("img/check.png")),t.children("span").text(ExposeTranslation.get(n?"button.dropping":"button.added")),e.set("dropped",!0),e.set("loading",!1);if(Array.isArray(i)){var s=r.fromJSON(i);u.trigger("timelineAdd",s),u.trigger("calendarAdd",s)}}})},undrop:function(e,t,n){var i=this;t.children("img").attr("src",f.staticAsset("img/loading_undrop.gif")),e.set("loading",!0),e.undrop({success:function(i){t.removeClass(n?"dropping":"in"),t.children("img").attr("src",f.staticAsset("img/drop.png")),t.children("span").text(ExposeTranslation.get(n?"button.drop":"button.add")),e.set("dropped",!1),e.set("loading",!1);if(Array.isArray(i)){var s=r.fromJSON(i);u.trigger("outOfCalendar",s),u.trigger("outOfTimeline",s)}}})}},l});