/*
 * jQuery UI Tabs @VERSION
 *
 * Copyright (c) 2007, 2008 Klaus Hartl (stilbuero.de)
 * Dual licensed under the MIT (MIT-LICENSE.txt)
 * and GPL (GPL-LICENSE.txt) licenses.
 *
 * http://docs.jquery.com/UI/Tabs
 *
 * Depends:
 *	ui.core.js
 */

(function(e){e.widget("ui.tabs",{_init:function(){this._tabify(!0)},_setData:function(e,t){/^selected/.test(e)?this.select(t):(this.options[e]=t,this._tabify())},length:function(){return this.$tabs.length},_tabId:function(t){return t.title&&t.title.replace(/\s/g,"_").replace(/[^A-Za-z0-9\-_:\.]/g,"")||this.options.idPrefix+e.data(t)},ui:function(e,t){return{options:this.options,tab:e,panel:t,index:this.$tabs.index(e)}},_sanitizeSelector:function(e){return e.replace(/:/g,"\\:")},_cookie:function(){var t=this.cookie||(this.cookie="ui-tabs-"+e.data(this.element[0]));return e.cookie.apply(null,[t].concat(e.makeArray(arguments)))},_tabify:function(t){function c(t,n){t.css({display:""}),e.browser.msie&&n.opacity&&t[0].style.removeAttribute("filter")}function d(e,t,n,i){var s=[r.selectedClass];r.deselectable&&s.push(r.deselectableClass),t.addClass(s.join(" ")).siblings().removeClass(s.join(" ")),p(e,n,i)}this.$lis=e("li:has(a[href])",this.element),this.$tabs=this.$lis.map(function(){return e("a",this)[0]}),this.$panels=e([]);var n=this,r=this.options;this.$tabs.each(function(t,i){if(i.hash&&i.hash.replace("#",""))n.$panels=n.$panels.add(n._sanitizeSelector(i.hash));else if(e(i).attr("href")!="#"){e.data(i,"href.tabs",i.href),e.data(i,"load.tabs",i.href);var s=n._tabId(i);i.href="#"+s;var o=e("#"+s);o.length||(o=e(r.panelTemplate).attr("id",s).addClass(r.panelClass).insertAfter(n.$panels[t-1]||n.element),o.data("destroy.tabs",!0)),n.$panels=n.$panels.add(o)}else r.disabled.push(t+1)});if(t){this.element.addClass(r.navClass),this.$panels.addClass(r.panelClass);if(r.selected===undefined)if(location.hash)this.$tabs.each(function(e,t){if(t.hash==location.hash)return r.selected=e,!1});else if(r.cookie){var i=parseInt(n._cookie(),10);i&&n.$tabs[i]&&(r.selected=i)}else n.$lis.filter("."+r.selectedClass).length&&(r.selected=n.$lis.index(n.$lis.filter("."+r.selectedClass)[0]));r.selected=r.selected===null||r.selected!==undefined?r.selected:0,r.disabled=e.unique(r.disabled.concat(e.map(this.$lis.filter("."+r.disabledClass),function(e,t){return n.$lis.index(e)}))).sort(),e.inArray(r.selected,r.disabled)!=-1&&r.disabled.splice(e.inArray(r.selected,r.disabled),1),this.$panels.addClass(r.hideClass),this.$lis.removeClass(r.selectedClass);if(r.selected!==null){this.$panels.eq(r.selected).removeClass(r.hideClass);var s=[r.selectedClass];r.deselectable&&s.push(r.deselectableClass),this.$lis.eq(r.selected).addClass(s.join(" "));var o=function(){n._trigger("show",null,n.ui(n.$tabs[r.selected],n.$panels[r.selected]))};e.data(this.$tabs[r.selected],"load.tabs")?this.load(r.selected,o):o()}e(window).bind("unload",function(){n.$tabs.unbind(".tabs"),n.$lis=n.$tabs=n.$panels=null})}else r.selected=this.$lis.index(this.$lis.filter("."+r.selectedClass)[0]);r.cookie&&this._cookie(r.selected,r.cookie);for(var u=0,a;a=this.$lis[u];u++)e(a)[e.inArray(u,r.disabled)!=-1&&!e(a).hasClass(r.selectedClass)?"addClass":"removeClass"](r.disabledClass);r.cache===!1&&this.$tabs.removeData("cache.tabs");var f,l;r.fx&&(r.fx.constructor==Array?(f=r.fx[0],l=r.fx[1]):f=l=r.fx);var h=l?function(e,t){t.animate(l,l.duration||"normal",function(){t.removeClass(r.hideClass),c(t,l),n._trigger("show",null,n.ui(e,t[0]))})}:function(e,t){t.removeClass(r.hideClass),n._trigger("show",null,n.ui(e,t[0]))},p=f?function(e,t,n){t.animate(f,f.duration||"normal",function(){t.addClass(r.hideClass),c(t,f),n&&h(e,n,t)})}:function(e,t,n){t.addClass(r.hideClass),n&&h(e,n)};this.$tabs.unbind(".tabs").bind(r.event+".tabs",function(){var t=e(this).parents("li:eq(0)"),i=n.$panels.filter(":visible"),s=e(n._sanitizeSelector(this.hash));if(t.hasClass(r.selectedClass)&&!r.deselectable||t.hasClass(r.disabledClass)||e(this).hasClass(r.loadingClass)||n._trigger("select",null,n.ui(this,s[0]))===!1)return this.blur(),!1;r.selected=n.$tabs.index(this);if(r.deselectable){if(t.hasClass(r.selectedClass))return n.options.selected=null,t.removeClass([r.selectedClass,r.deselectableClass].join(" ")),n.$panels.stop(),p(this,i),this.blur(),!1;if(!i.length){n.$panels.stop();var o=this;return n.load(n.$tabs.index(this),function(){t.addClass([r.selectedClass,r.deselectableClass].join(" ")),h(o,s)}),this.blur(),!1}}r.cookie&&n._cookie(r.selected,r.cookie),n.$panels.stop();if(!s.length)throw"jQuery UI Tabs: Mismatching fragment identifier.";var o=this;return n.load(n.$tabs.index(this),i.length?function(){d(o,t,i,s)}:function(){t.addClass(r.selectedClass),h(o,s)}),e.browser.msie&&this.blur(),!1}),r.event!="click"&&this.$tabs.bind("click.tabs",function(){return!1})},add:function(t,n,r){r==undefined&&(r=this.$tabs.length);var i=this.options,s=e(i.tabTemplate.replace(/#\{href\}/g,t).replace(/#\{label\}/g,n));s.data("destroy.tabs",!0);var o=t.indexOf("#")==0?t.replace("#",""):this._tabId(e("a:first-child",s)[0]),u=e("#"+o);u.length||(u=e(i.panelTemplate).attr("id",o).addClass(i.hideClass).data("destroy.tabs",!0)),u.addClass(i.panelClass),r>=this.$lis.length?(s.appendTo(this.element),u.appendTo(this.element[0].parentNode)):(s.insertBefore(this.$lis[r]),u.insertBefore(this.$panels[r])),i.disabled=e.map(i.disabled,function(e,t){return e>=r?++e:e}),this._tabify();if(this.$tabs.length==1){s.addClass(i.selectedClass),u.removeClass(i.hideClass);var a=e.data(this.$tabs[0],"load.tabs");a&&this.load(r,a)}this._trigger("add",null,this.ui(this.$tabs[r],this.$panels[r]))},remove:function(t){var n=this.options,r=this.$lis.eq(t).remove(),i=this.$panels.eq(t).remove();r.hasClass(n.selectedClass)&&this.$tabs.length>1&&this.select(t+(t+1<this.$tabs.length?1:-1)),n.disabled=e.map(e.grep(n.disabled,function(e,n){return e!=t}),function(e,n){return e>=t?--e:e}),this._tabify(),this._trigger("remove",null,this.ui(r.find("a")[0],i[0]))},enable:function(t){var n=this.options;if(e.inArray(t,n.disabled)==-1)return;var r=this.$lis.eq(t).removeClass(n.disabledClass);e.browser.safari&&(r.css("display","inline-block"),setTimeout(function(){r.css("display","block")},0)),n.disabled=e.grep(n.disabled,function(e,n){return e!=t}),this._trigger("enable",null,this.ui(this.$tabs[t],this.$panels[t]))},disable:function(e){var t=this,n=this.options;e!=n.selected&&(this.$lis.eq(e).addClass(n.disabledClass),n.disabled.push(e),n.disabled.sort(),this._trigger("disable",null,this.ui(this.$tabs[e],this.$panels[e])))},select:function(e){typeof e=="string"&&(e=this.$tabs.index(this.$tabs.filter("[href$="+e+"]")[0])),this.$tabs.eq(e).trigger(this.options.event+".tabs")},load:function(t,n){var r=this,i=this.options,s=this.$tabs.eq(t),o=s[0],u=n==undefined||n===!1,a=s.data("load.tabs");n=n||function(){};if(!a||!u&&e.data(o,"cache.tabs")){n();return}var f=function(t){var n=e(t),r=n.find("*:last");return r.length&&r.is(":not(img)")&&r||n},l=function(){r.$tabs.filter("."+i.loadingClass).removeClass(i.loadingClass).each(function(){i.spinner&&f(this).parent().html(f(this).data("label.tabs"))}),r.xhr=null};if(i.spinner){var c=f(o).html();f(o).wrapInner("<em></em>").find("em").data("label.tabs",c).html(i.spinner)}var h=e.extend({},i.ajaxOptions,{url:a,success:function(s,u){e(r._sanitizeSelector(o.hash)).html(s),l(),i.cache&&e.data(o,"cache.tabs",!0),r._trigger("load",null,r.ui(r.$tabs[t],r.$panels[t]));try{i.ajaxOptions.success(s,u)}catch(a){}n()}});this.xhr&&(this.xhr.abort(),l()),s.addClass(i.loadingClass),r.xhr=e.ajax(h)},url:function(e,t){this.$tabs.eq(e).removeData("cache.tabs").data("load.tabs",t)},destroy:function(){var t=this.options;this.element.unbind(".tabs").removeClass(t.navClass).removeData("tabs"),this.$tabs.each(function(){var t=e.data(this,"href.tabs");t&&(this.href=t);var n=e(this).unbind(".tabs");e.each(["href","load","cache"],function(e,t){n.removeData(t+".tabs")})}),this.$lis.add(this.$panels).each(function(){e.data(this,"destroy.tabs")?e(this).remove():e(this).removeClass([t.selectedClass,t.deselectableClass,t.disabledClass,t.panelClass,t.hideClass].join(" "))}),t.cookie&&this._cookie(null,t.cookie)}}),e.extend(e.ui.tabs,{version:"@VERSION",getter:"length",defaults:{deselectable:!1,event:"click",disabled:[],cookie:null,spinner:"Loading&#8230;",cache:!1,idPrefix:"ui-tabs-",ajaxOptions:null,fx:null,tabTemplate:'<li><a href="#{href}"><span>#{label}</span></a></li>',panelTemplate:"<div></div>",navClass:"ui-tabs-nav",selectedClass:"ui-tabs-selected",deselectableClass:"ui-tabs-deselectable",disabledClass:"ui-tabs-disabled",panelClass:"ui-tabs-panel",hideClass:"ui-tabs-hide",loadingClass:"ui-tabs-loading"}}),e.extend(e.ui.tabs.prototype,{rotation:null,rotate:function(e,t){function i(){n.rotation=setInterval(function(){r=++r<n.$tabs.length?r:0,n.select(r)},e)}function s(e){(!e||e.clientX)&&clearInterval(n.rotation)}t=t||!1;var n=this,r=this.options.selected;e?(i(),t?this.$tabs.bind(this.options.event+".tabs",function(){s(),r=n.options.selected,i()}):this.$tabs.bind(this.options.event+".tabs",s)):(s(),this.$tabs.unbind(this.options.event+".tabs",s))}})})(jQuery);