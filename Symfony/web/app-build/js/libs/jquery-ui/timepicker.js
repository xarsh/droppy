/*
 * Copyright (c) 2006 Sam Collett (http://www.texotela.co.uk)
 * Licensed under the MIT License:
 * http://www.opensource.org/licenses/mit-license.php
 */

(function(e){function t(t,n,r,i){t.value=e(n).text(),e(t).change(),e.browser.msie||t.focus(),r.hide()}function n(e,t){var n=e.getHours(),i=t.show24Hours?n:(n+11)%12+1,s=e.getMinutes();return r(i)+t.separator+r(s)+(t.show24Hours?"":n<12?" AM":" PM")}function r(e){return(e<10?"0":"")+e}function i(e,t){if(e){var n=e.split(t.separator),r=parseFloat(n[0]),i=parseFloat(n[1]),o=new Date(0,0,0,r,i,0);return s(o)}return null}function s(e){return e.setFullYear(2001),e.setMonth(0),e.setDate(0),e}e.fn.timePicker=function(t){var n=e.extend({},e.fn.timePicker.defaults,t);return this.each(function(){e.timePicker(this,n)})},e.timePicker=function(t,n){return t=e(t)[0],t.timePicker||(t.timePicker=new jQuery._timePicker(t,n))},e._timePicker=function(r,o){var u=!1,a=s(o.startTime),f=s(o.endTime);e(r).attr("autocomplete","OFF");var l=[],c=new Date(a);while(c<=f)l[l.length]=n(c,o),c=new Date(c.setMinutes(c.getMinutes()+o.step));var h=e('<div class="time-picker'+(o.show24Hours?"":" time-picker-12hours")+'"></div>'),p=e("<ul></ul>");for(var d=0;d<l.length;d++)p.append("<li>"+l[d]+"</li>");h.append(p);var v=e(r).offset();h.appendTo("body").css({top:v.top,left:v.left}).hide(),e("li",p).unbind().mouseover(function(){e("li.selected",h).removeClass("selected"),e(this).addClass("selected")}).mousedown(function(){u=!0}).click(function(){t(r,this,h,o),u=!1});var m=function(){var t=e(r).offset();h.css({top:t.top+20,left:t.left}),h.show(),h.mouseover(function(){u=!0}).mouseout(function(){u=!1}),e("li",h).removeClass("selected");var l=this.value?i(this.value,o):a,c=a.getHours()*60+a.getMinutes(),p=l.getHours()*60+l.getMinutes()-c,d=Math.round(p/o.step),v=s(new Date(2001,0,0,0,d*o.step+c,0));v=a<v&&v<f?v:a;var m=e("li:contains("+n(v,o)+")",h);m.length&&(m.addClass("selected"),h[0].scrollTop=m[0].offsetTop)};e(r).unbind().focus(m).click(m).blur(function(){!u&&h[0].parentNode&&h.hide()}).keypress(function(n){switch(n.keyCode){case 38:case 63232:var i=e("li.selected",p),s=i.prev().addClass("selected")[0];return s&&(i.removeClass("selected"),h[0].scrollTop=s.offsetTop),!1;case 40:case 63233:var i=e("li.selected",p),u=i.length?i.next().addClass("selected")[0]:e("li:first").addClass("selected")[0];return u&&(i.removeClass("selected"),h[0].scrollTop=u.offsetTop),!1;case 13:if(!h.is(":hidden")){var a=e("li.selected",p)[0];return t(r,a,h,o),!1}}}),this.getTime=function(){return i(r.value,o)},this.setTime=function(t){r.value=n(s(t),o),e(r).change()}},e.fn.timePicker.defaults={step:30,startTime:new Date(0,0,0,0,0,0),endTime:new Date(0,0,0,23,30,0),separator:":",show24Hours:!0}})(jQuery);