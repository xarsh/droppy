define(["jQuery","Underscore","Backbone","views/timeline/timeline_event","event_manager","helpers/assets"],function(e,t,n,r,i,s){var o=n.View.extend({el:"div#timeline",events:{"focus div.event_lists":"blur","jsp-scroll-y .scrollable":"loadMore"},initialize:function(e){this.views=[],this.scrollPane=this.$el.jScrollPane({verticalGutter:0,autoReinitialise:!0,scrollbarMargin:0}),this.timeline=e,i.on("timelineAdd",this.timeline.add,this.timeline),i.on("outOfTimeline",this.timeline.remove,this.timeline),this.timeline.bind("add",this.addOne,this),this.timeline.bind("reset",this.addAll,this)},loadMore:function(e,t,n,r){r&&this.timeline.loadMore()},blur:function(t){e(t.target).blur()},addOne:function(e,t,n){var i=new r({model:e});container=this.scrollPane,api=container.data("jsp"),contentPane=api.getContentPane();var s=e.timelineCategory(),o=contentPane.find("div."+s);this.views.push(i);var u=i.render().el;if(n.append||typeof n.index=="undefined")o.append(u);else if(n.index===0)o.children().after(u);else{var a=this.timeline.at(n.index-1).get("id"),f=o.find('div[event-id="'+a+'"]').parent();f.length===0?o.children(".daybar").after(u):f.after(u)}o.show()},addAll:function(){this.$el.find(".loading").remove(),this.$el.find("div.timeline_container div").not(".daybar").remove(),this.$el.find("div.timeline_container").hide();for(var e=0;e<this.timeline.length;e++)this.addOne(this.timeline.at(e),{},{append:!0})}});return o});