define(["jQuery","Underscore","Backbone","views/calendar/popup","model/event","helpers/template_manager","event_manager","helpers/assets"],function(e,t,n,r,i,s,o,u){var a=r.extend({initialize:function(){this.date=new Date,this.events=t.extend({},r.prototype.events,this.events),this.keyPressCount=0,r.prototype.initialize(this.$el)},template:t.template(s.getEventCreationPopupTemplate()),events:{"keyup input.title":"updateModel","keypress input.title":"increaseKeyPressCount","click span.button_big":"saveAndQuit","click a.setting_details":"toDetails"},increaseKeyPressCount:function(e){var t=e.which||e.keycode;t!==241&&t!==242&&this.keyPressCount++},setDate:function(e){var t=Date.parse(e);t=isNaN(t)?new Date:new Date(t),this.date=t},updateModel:function(t){var n=t.which||t.keycode;t.preventDefault(),this.model.set("name",e(t.target).val()),this.keyPressCount--,this.keyPressCount<0?this.keyPressCount=0:(this.model.set("name",e(t.target).val()),n===13&&this.saveAndQuit())},saveAndQuit:function(){this.close(),this.model.set("name",this.$("input.title").val()),this.model.save({},{success:function(){o.trigger("success",ExposeTranslation.get("common.event_update_success"))}})},render:function(){this.model=new i;var e=this.model.get("startDateTime").get("date"),t=this.model.get("endDateTime").get("date");return e.setFullYear(this.date.getFullYear(),this.date.getMonth(),this.date.getDate()),t.setFullYear(this.date.getFullYear(),this.date.getMonth(),this.date.getDate()),this.$el.html(this.template(u.wrapAssetics({date:this.date}))),this.delegateEvents(this.events),this}});return new a});