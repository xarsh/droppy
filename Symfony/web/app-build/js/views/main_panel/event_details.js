define(["jQuery","Underscore","Backbone","model/event","helpers/template_manager","event_manager","helpers/assets"],function(e,t,n,r,i,s,o){var u=n.View.extend({initialize:function(){this.model=new r,this.loaded=!1},el:"div#event",events:{"click div.event_username":"showUserDetails","click .button_big":"back","click span.button_small.edit":"editEvent","click span.button_small.delete":"deleteEvent","click span.button_small.drop":"toggleDrop","click div.event_description a":"openLink"},update:function(e){s.trigger("loading"),this.model.clear(),this.model.set("id",e);var t=this;this.model.fetch({success:function(e,n){s.trigger("endLoading"),s.trigger("loaded",t)}})},openLink:function(t){t.preventDefault();var n=e(t.target);window.open(n.attr("href"))},editEvent:function(e){s.trigger("editEvent",this.model)},deleteEvent:function(e){this.model.destroy(),s.trigger("changePage","top")},toggleDrop:function(){if(this.model.get("loading"))return;this.model.get("dropped")?s.trigger("undrop",this.model,this.$("span.button_small")):s.trigger("drop",this.model,this.$("span.button_small"))},template:t.template(i.getEventDetailsTemplate()),render:function(){return this.$("div.event_details").html(this.template(o.wrapAssetics(this.model.display()))),this},showUserDetails:function(e){e.stopPropagation(),e.preventDefault(),s.trigger("changePage","user",{username:this.model.get("creator").get("username")})},show:function(){this.render(),this.loaded=!0,this.$el.show()},closeEvent:function(e){this.model.undrop()},back:function(){s.trigger("back")}});return new u});