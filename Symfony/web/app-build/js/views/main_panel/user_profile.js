define(["jQuery","Underscore","Backbone","model/user","collections/user_list","views/general/user_list","collections/event_list","views/general/event_list","helpers/template_manager","event_manager","app_user","helpers/assets"],function(e,t,n,r,i,s,o,u,a,f,l,c){var h=n.View.extend({initialize:function(){this.model=new r,this.loaded=!1},el:"div#user",template:t.template(a.getUserProfileTemplate()),initCreatedEvents:function(){this.eventList=new o,t.extend(this.eventList,{routeList:{read:"droppy_event_ajax_created_events"},params:{user_id:this.model.get("id")}}),new u({eventList:this.eventList,templateName:"single_event",el:"div#created div.eventlist",showCreator:!1})},initDroppings:function(){this.droppings=new i,t.extend(this.droppings,{routeList:{read:"droppy_user_ajax_dropping_users"},params:{user_id:this.model.get("id")},comparator:function(e){return e.get("droppingUsersNumber")}}),new s({userList:this.droppings,templateName:"single_user",el:"div#dropping  div.userlist"})},render:function(){return this.$("div.summary").html(this.template(c.wrapAssetics(t.extend({appUser:l.toJSON()},this.model.toJSON())))),this},initElements:function(){this.$tabs=this.$("div#tabs").tabs(),this.$el.jScrollPane({verticalGutter:0,autoReinitialise:!0,contentWidth:"0px"})},events:{"click .button_big":"back","focus div#user_details":"blur","click div.title_names div.button.drop":"toggleDrop","click div.title_names div.introduce":"openLink","jsp-scroll-y":"loadMore"},openLink:function(t){t.preventDefault();var n=e(t.target);window.open(n.attr("href"))},loadMore:function(e,t,n,r){if(r){var i=this.$tabs.tabs("option","selected"),s=[this.droppings,this.eventList];s[i].loadMore()}},blur:function(){this.$("div#user_details").blur()},toggleDrop:function(t){$target=e(t.target),$target.is("div")||($target=$target.parent());if(this.model.get("loading"))return;this.model.get("dropped")?f.trigger("undrop",this.model,$target,!0):f.trigger("drop",this.model,$target,!0)},update:function(e){f.trigger("loading"),this.model.clear(),this.model.set("username",e);var t=this;this.model.fetch({success:function(e,n){f.trigger("endLoading"),f.trigger("loaded",t),t.initDroppings(),t.initCreatedEvents()}})},show:function(){this.render(),this.$el.show(),this.initElements(),this.loaded=!0},back:function(){f.trigger("back")}});return new h});