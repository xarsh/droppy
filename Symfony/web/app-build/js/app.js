define(["jQuery","Underscore","Backbone","router","model/user","data_manager","views/top_message","event_manager","app_user","views/includes/app_user_profile","views/includes/welcome"],function(e,t,n,r,i,s,o,u,a,f,l){var c=n.View.extend({initialize:function(){this.loading=0,this.dataManager=new s,this.topMessageView=o,this.initEvents(),e(window).resize(this.resize),this.router=r.initialize(),a.get("hasStarted")||new l,this.$("div#left").prepend(f.el)},initEvents:function(){u.on("changePage",this.changePage,this),u.on("loading",this.setLoading,this),u.on("endLoading",this.endLoading,this),u.on("back",this.back,this),u.on("loaded",this.showPage,this),u.on("pageChanged",this.pageChanged,this),u.on("success",this.success,this)},el:e("div#wrapper"),events:{"click div.logo":"toTop","click div.home a":"toTop","click div.make_event a":"eventCreation","click div.recommend a":"recommendations","click div.pulldown":"showMenu","keyup input.search_txt":"makeSearch","click #account_info":"showUser"},isLoading:function(){return this.loading},success:function(e){this.topMessageView.showSuccessMessage(e)},showUser:function(e){e.preventDefault(),this.changePage("user",{username:a.get("username")})},toTop:function(e){e.preventDefault(),this.changePage(this.router.generateRoute("top"))},setLoading:function(){if(this.loading===0){var e=ExposeTranslation.get("common.loading");this.topMessageView.showInformationMessage(e,-1)}this.loading++},endLoading:function(){this.loading--,this.loading<0&&(this.loading=0),this.loading===0&&this.topMessageView.hideLoading()},makeSearch:function(t){var n=t.which||t.keycode,r=e(t.target);n==13&&(this.changePage("search",{keyword:r.val()}),r.val(""),r.blur())},changePage:function(e,t){var n=this.router.generateRoute(e,t);if("#"+n===window.location.hash)return;this.router.navigate(n,{trigger:!0})},eventCreation:function(e){e.preventDefault(),this.changePage("event_creation")},recommendations:function(e){e.preventDefault(),this.changePage("recommendations")},showMenu:function(t){e("#pulldown_items").not(":animated").slideToggle("fast")},back:function(){window.history.back()},showPage:function(e){if(!e.loaded){var t=e.render().el;this.$("div#main").prepend(t)}this.$("div#main").children("div").hide(),e.show(),this.resize()},pageChanged:function(e,t){this.resize(),this.router.navigate(this.router.generateRoute(e,t))},resize:function(){var t=document.documentElement.clientHeight||document.body.clientHeight||document.body.scrollHeight;e("div#timeline").height(t-125-35),e("#col2_content .recommended_users").find("div").each(function(){e(this).show();if(e(this).offset().top+100>t)return e(this).nextAll().hide(),!1}),e("#user").height(t-35),e("div.search").height(t-35),u.trigger("resize")}}),h=function(){n.emulateHTTP=!0,new c};return{initialize:h}});