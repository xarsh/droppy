/*
 RequireJS text 0.27.0 Copyright (c) 2010-2011, The Dojo Foundation All Rights Reserved.
 Available via the MIT or new BSD license.
 see: http://github.com/jrburke/requirejs for details
*/

define("Sync",["jQuery","Underscore"],function(e,t){var n={};return n.makeRequest=function(n,r,i){var s=n==="read"?"GET":"POST";i.type=s;var o={data:r},r=t.extend(o,i);return e.ajax(r)},n}),define("model/user",["jQuery","Underscore","Backbone","Sync"],function(e,t,n,r){var i=n.RelationalModel.extend({parse:function(e){var t=Object.keysToCamelCase(e.user);return t.dropped=e.dropped,t},setFromJSON:function(e){var t=this.parse(e);this.set(t)},drop:function(e){t.extend(e,{url:Routing.generate("droppy_user_ajax_drop"),dataType:"json"}),r.makeRequest("create",{user_id:this.get("id")},e)},undrop:function(e){t.extend(e,{url:Routing.generate("droppy_user_ajax_undrop"),dataType:"json"}),r.makeRequest("delete",{user_id:this.get("id")},e)},sync:function(e,t,r){var i={read:Routing.generate("droppy_user_ajax_get_by_username",{username:this.get("username")})};return r.url=i[e],n.sync(e,t,r)}});return i}),define("model/event_date_time",["jQuery","Underscore","Backbone"],function(e,t,n){var r=n.RelationalModel.extend({defaults:function(){return{date:Date.getCurrent(),allDay:!0}},initialize:function(){this.get("date")||this.set("date",this.defaults.date),this.get("allDay")||this.set("allDay",this.defaults.allDay),this.bind("change",this.checkAllDay,this)},checkAllDay:function(){typeof this.get("allDay")=="undefined"&&this.set("allDay",!1)},timelineCategory:function(){return this.get("date").getCategory()},isSameDate:function(e){return this.get("date").dateEquals(e.get("date"))},compare:function(e){return this.isSameDate(e)?this.get("allDay")!==e.get("allDay")?this.get("allDay")?1:-1:this.get("allDay")?0:e.get("date")-this.get("date"):e.get("date")-this.get("date")},parse:function(e){return r.parse(e)},format:function(){var e=this.toJSON(),t=this.get("date");return e.date=t.format("Y/m/d"),e.time=t.format("H:i"),Object.keysToCamelCase(e)},getString:function(e){e=typeof e!="undefined"?new Date(e):new Date,e.setFullYear(e.getFullYear()+1);var t="",n=this.get("date"),r=n<e?"month_day_dow":"year_month_day_dow",i=ExposeTranslation.get("time."+r);return t+=n.format(i),this.get("allDay")||(t+=" "+n.format("H:i")),t}});return r.parse=function(e){var t={},n=e.date;return t.date=new Date(n.year,n.month-1,n.day),t.allDay=e.all_day||e.allDay,t.allDay||t.date.setHours(e.time.hour,e.time.minute),t},r}),define("event_manager",["jQuery","Underscore","Backbone"],function(e,t,n){var r=t.clone(n.Events);return r}),define("model/event",["jQuery","Underscore","Backbone","Sync","model/user","model/event_date_time","event_manager"],function(e,t,n,r,i,s,o){var u=n.RelationalModel.extend({relations:[{type:n.HasOne,key:"creator",relatedModel:i},{type:n.HasOne,key:"startDateTime",relatedModel:s},{type:n.HasOne,key:"endDateTime",relatedModel:s}],defaults:function(){return{name:ExposeTranslation.get("event.default_name"),startDateTime:new s}},initialize:function(){(!this.get("name")||this.get("name")===null)&&this.set("name",this.defaults().name),(!this.get("startDateTime")||this.get("startDateTime")===null)&&this.set("startDateTime",new s);if(!this.get("endDateTime")||this.get("endDateTime")===null){this.set("endDateTime",new s);var e=this.get("endDateTime").get("date");e.setHours(e.getHours()+1)}},validate:function(){},timelineCategory:function(){return this.get("startDateTime").get("date")<new Date?"today":this.get("startDateTime").timelineCategory()},setFromJSON:function(e){var t=this.parse(e);this.set(t)},compareDates:function(e){return this.get("startDateTime").isSameDate(e.get("startDateTime"))?this.get("endDateTime")&&e.get("endDateTime")&&!this.get("endDateTime").isSameDate(e.get("endDateTime"))?e.get("endDateTime").compare(this.get("endDateTime")):this.get("startDateTime").compare(e.get("startDateTime")):this.get("startDateTime").compare(e.get("startDateTime"))},parse:function(e,t){var n=Object.keysToCamelCase(e.event);return n.liked="liked"in e?e.liked:!1,n.inCalendar=e.relation!==null?e.relation.in_calendar:!1,n.isCreator=e.relation!==null?e.relation.user_is_creator:!1,n.startDateTime=s.parse(n.startDateTime),n.endDateTime=s.parse(n.endDateTime),n.dropped=e.relation!==null,n},sync:function(e,t,i){var s={create:Routing.generate("droppy_event_ajax_update_event"),read:Routing.generate("droppy_event_ajax_event_and_rel",{event_id:this.get("id")}),update:Routing.generate("droppy_event_ajax_update_event"),"delete":Routing.generate("droppy_event_ajax_remove_event")};i.url=s[e];if(e==="delete"){var u={event_id:this.get("id")};return o.trigger("outOfTimeline",this),o.trigger("outOfCalendar",this),r.makeRequest("delete",u,i)}if(e==="create"){var a=i.success,t=this;i.success=function(e,n,r){a&&a(e,n,r),t.notifyAdd(t)}}return n.sync(e,t,i)},notifyAdd:function(e){e=e||this,o.trigger("calendarAdd",e),e.get("endDateTime").get("date")>=Date.getToday()&&o.trigger("timelineAdd",e)},getObject:function(){return n.RelationalModel.prototype.toJSON.call(this)},inCalendar:function(e){e=e||{},t.extend(e,{url:Routing.generate("droppy_event_ajax_event_in")}),r.makeRequest("update",{event_id:this.get("id")},e),this.set("inCalendar",!0)},outOfCalendar:function(e){e=e||{},t.extend(e,{url:Routing.generate("droppy_event_ajax_event_out")}),r.makeRequest("update",{event_id:this.get("id")},e),this.set("inCalendar",!1)},toJSON:function(e){var t=this.getObject();return t.startDateTime=this.get("startDateTime").format(),t.endDateTime=this.get("endDateTime").format(),Object.keysFromCamelCase(t)},dateToString:function(){var e=this.get("startDateTime"),t=this.get("endDateTime"),n=e.getString();return e.compare(t)===0?n:(n+=" 〜 ",e.get("date").dateEquals(t.get("date"))?n+=t.get("date").format("H:i"):n+=t.getString(e.get("date")),n)},display:function(){var e=this.getObject();return e.startDateString=this.get("startDateTime").getString(),e.endDateString=this.get("endDateTime").getString(),e.date=this.dateToString(),e},drop:function(e){e=e||{},t.extend(e,{url:Routing.generate("droppy_event_ajax_drop")}),r.makeRequest("create",{event_id:this.get("id")},e),this.set("dropped",!0),this.set("inCalendar",!0)},undrop:function(e){e=e||{},t.extend(e,{url:Routing.generate("droppy_event_ajax_undrop")}),r.makeRequest("delete",{event_id:this.get("id")},e),o.trigger("outOfTimeline",this),o.trigger("outOfCalendar",this),this.set("dropped",!1)}});return u}),function(){var e=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],t=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,n=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,r=typeof location!="undefined"&&location.href,i=r&&location.protocol&&location.protocol.replace(/\:/,""),s=r&&location.hostname,o=r&&(location.port||void 0),u=[];define("text",[],function(){var a,f,l;return typeof window!="undefined"&&window.navigator&&window.document?f=function(e,t){var n=a.createXhr();n.open("GET",e,!0),n.onreadystatechange=function(){n.readyState===4&&t(n.responseText)},n.send(null)}:typeof process!="undefined"&&process.versions&&process.versions.node?(l=require.nodeRequire("fs"),f=function(e,t){t(l.readFileSync(e,"utf8"))}):typeof Packages!="undefined"&&(f=function(e,t){var n=new java.io.File(e),r=java.lang.System.getProperty("line.separator"),n=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(n),"utf-8")),i,s,o="";try{i=new java.lang.StringBuffer,(s=n.readLine())&&s.length()&&s.charAt(0)===65279&&(s=s.substring(1));for(i.append(s);(s=n.readLine())!==null;)i.append(r),i.append(s);o=String(i.toString())}finally{n.close()}t(o)}),a={version:"0.27.0",strip:function(e){if(e){var e=e.replace(t,""),r=e.match(n);r&&(e=r[1])}else e="";return e},jsEscape:function(e){return e.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r")},createXhr:function(){var t,n,r;if(typeof XMLHttpRequest!="undefined")return new XMLHttpRequest;for(n=0;n<3;n++){r=e[n];try{t=new ActiveXObject(r)}catch(i){}if(t){e=[r];break}}if(!t)throw Error("createXhr(): XMLHttpRequest not available");return t},get:f,parseName:function(e){var t=!1,n=e.indexOf("."),r=e.substring(0,n),e=e.substring(n+1,e.length),n=e.indexOf("!");return n!==-1&&(t=e.substring(n+1,e.length),t=t==="strip",e=e.substring(0,n)),{moduleName:r,ext:e,strip:t}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(e,t,n,r){var i=a.xdRegExp.exec(e),s;return i?(e=i[2],i=i[3],i=i.split(":"),s=i[1],i=i[0],(!e||e===t)&&(!i||i===n)&&(!s&&!i||s===r)):!0},finishLoad:function(e,t,n,r,i){n=t?a.strip(n):n,i.isBuild&&i.inlineText&&(u[e]=n),r(n)},load:function(e,t,n,u){var f=a.parseName(e),l=f.moduleName+"."+f.ext,c=t.toUrl(l),h=u&&u.text&&u.text.useXhr||a.useXhr;!r||h(c,i,s,o)?a.get(c,function(t){a.finishLoad(e,f.strip,t,n,u)}):t([l],function(e){a.finishLoad(f.moduleName+"."+f.ext,f.strip,e,n,u)})},write:function(e,t,n){if(t in u){var r=a.jsEscape(u[t]);n.asModule(e+"!"+t,"define(function () { return '"+r+"';});\n")}},writeFile:function(e,t,n,r,i){var t=a.parseName(t),s=t.moduleName+"."+t.ext,o=n.toUrl(t.moduleName+"."+t.ext)+".js";a.load(s,n,function(){var t=function(e){return r(o,e)};t.asModule=function(e,t){return r.asModule(e,o,t)},a.write(e,s,t,i)},i)}}})}(),define("text!templates/calendar/calendar.html",[],function(){return'<div id="main_calendar">\n    <div class="calendar_tools">\n        <table width="100%" cellpadding="0" border="0">\n            <tbody><tr>\n                    <td class="date"></td>\n                    <td class="center">&nbsp;</td>\n                    <td class="right">\n                        <div class="change_date">\n                            <span class="calendar_button current"><%= ExposeTranslation.get(\'time.this_month\') %></span>\n                            <span class="calendar_button prev" unselectable="on">&lt;</span>\n                            <span class="calendar_button next" unselectable="on">&gt;</span>\n                        </div>\n                    </td>\n            </tr></tbody>\n        </table>\n    </div><!-- calendar_tools -->\n    <div class="calendar">\n        <table class="calendar">\n            <thead>\n                <tr>\n                    <th class="sun"><%= ExposeTranslation.get(\'time.day_of_week.sun\') %></th>\n                    <th><%= ExposeTranslation.get(\'time.day_of_week.mon\') %></th>\n                    <th><%= ExposeTranslation.get(\'time.day_of_week.tue\') %></th>\n                    <th><%= ExposeTranslation.get(\'time.day_of_week.wed\') %></th>\n                    <th><%= ExposeTranslation.get(\'time.day_of_week.thu\') %></th>\n                    <th><%= ExposeTranslation.get(\'time.day_of_week.fri\') %></th>\n                    <th class="sat"><%= ExposeTranslation.get(\'time.day_of_week.sat\') %></th>\n                </tr>\n            </thead>\n            <tbody>\n                <% for(var i = 0; i < 6; i++) { %>\n                    <tr>\n                    <% for(var j = 0; j < 7; j++) { %> \n	                    <td>\n	                        <p></p>\n	                    </td>\n                    <% } %>\n                    </tr>\n                <% } %>\n            </tbody>\n        </table>\n    </div><!-- calendar -->\n</div>\n'}),define("text!templates/event_creation_popup.html",[],function(){return'<div id="make_event_popup" class="popup">\n    <a class="close">\n        <span class="csssprite close">close</span>\n    </a>\n        <table border="0" cellspacing="0" cellpadding="0">\n            <col style="width: 60px;">\n            <col style="width: 200px;">\n            <tbody>\n                <tr>\n                    <td class="label"><%= ExposeTranslation.get(\'time.date\') %></td>\n                    <td class="value date"><%= date.format(ExposeTranslation.get(\'time.year_month_day\')) %></td>\n                </tr>\n                    <td class="label"><%= ExposeTranslation.get(\'event.title\') %></td>\n                    <td class="value title"><input type="text" class="title" /></td>\n                </tr>\n            </tbody>\n        </table>\n        <div class="popup_buttons">\n            <span class="button_big drop"><%= ExposeTranslation.get(\'button.disclose_event\') %></span>\n\n            <a class="setting_details">\n                <%= ExposeTranslation.get(\'event.set_details\') %>&nbsp;&gt;&gt;\n            </a>\n        </div>\n</div>\n'}),define("text!templates/event_creation.html",[],function(){return'<div id="event_update">\n    <p class="event_creation head_title">\n    	<span class="csssprite icon_new">icon_new</span>\n    	<%= ExposeTranslation.get(\'event.make_event\') %>\n    </p>\n    <div class="buttons">\n        <span class="head_button">\n            <span id="back_button" class="button_big white"><%= ExposeTranslation.get(\'common.back\') %></span>\n        </span>\n        <span class="head_button">\n            <span id="create_button" class="button_big light_blue">\n                <%= ExposeTranslation.get(\'common.create\') %>\n            </span>\n        </span>\n        <span class="caution">(<%= ExposeTranslation.get(\'event.caution\') %>)</span>\n    </div>\n    <div id="event_creation_form">\n            <div class="event_summary">\n                <div class="title_form">\n                    <input id="event_title" class="title_form" placeholder="<%= ExposeTranslation.get(\'event.title\') %>" \n                        value="<%= (name == ExposeTranslation.get(\'event.default_name\')) ? \'\' : name %>" type="text" />\n                </div>\n                <span class="datetime_form" id="start_datetime_form">\n                    <input type="text" id="event_start_date" class="date datepicker" value="<%= startDateTime.date.format(\'Y/m/d\') %>" />\n                    <input type="text" id="event_start_time" class="time timepicker" value="<%= startDateTime.date.format(\'H:i\') %>" style="display: <%= startDateTime.allDay ? \'none\' : \'inline\' %>;" />\n                        \n                </span><span id="to">～</span>\n                <span class="datetime_form" id="end_datetime_form">\n                    <input type="text" id="event_end_date" class="date datepicker" value="<%= endDateTime.date.format(\'Y/m/d\') %>" />\n                    <input type="text" id="event_end_time" class="time timepicker" value="<%= endDateTime.date.format(\'H:i\') %>" style="display: <%= endDateTime.allDay ? \'none\' : \'inline\' %>;" /> \n                        \n                </span>\n                <div class="options">\n                    <span class="option">\n                        <input type="checkbox" id="event_allday" name="event_allday" <%= startDateTime.allDay ? \'checked="checked"\' : \'\' %> />\n                        <label for="event_allday">\n                            <%= ExposeTranslation.get(\'event.allday\') %>\n                        </label>\n                        <span style="display:none;">\n                            <input type="checkbox" id="event_privacy" name="event_privacy" checked="checked" />\n                            <label for="event_privacy"><%= ExposeTranslation.get(\'privacy_policy.public\') %></label>\n                        </span>\n                    </span>\n                </div>\n            </div>\n            <div class="event_details">\n                <table border="0" cellspacing="0" cellpadding="0">\n                    <tr><th><%= ExposeTranslation.get(\'event.place\') %></th>\n                        <td><input type="text" id="event_place" value="<%= typeof location != \'undefined\' && location.place ? location.place : \'\'%>" /></td> \n                    </tr>\n                    <tr><th><%= ExposeTranslation.get(\'event.address\') %></th>\n                        <td><input type="text" id="event_address" value="<%= typeof address != \'undefined\' && address ? address : \'\'%>"/> </td>                            \n                    </tr>\n                    <tr><th><%= ExposeTranslation.get(\'event.details\') %></th>\n                        <td><textarea id="event_details"><%= typeof details != \'undefined\' && details ? details : \'\' %></textarea></td>\n                    </tr>\n                    <tr><th><%= ExposeTranslation.get(\'event.color\') %></th>\n                        <td>\n                            <% var colors = ["red", "orange", "yellow", "green", "blue", "violet"] %>\n                            <div id="color_sample">\n                            <% var color = (typeof color !== \'undefined\' && color.name) ? color.name : \n                                (typeof appUser.get(\'settings\') !== \'undefined\' ? appUser.get(\'settings\').color.name : \'\') %> \n                            <% for(var i in colors) { %>                                \n                                <div class="<%= colors[i] %> <%= colors[i] == color ? \'clicked\' : \'\' %>">&nbsp;</div>\n                            <% } %>\n                            </div>\n                        </td>\n                    </tr>\n                    <tr><th><%= ExposeTranslation.get(\'event.tag.label\') %></th>\n                        <td><input type="text" id="event_tags" value="<%= typeof tags !== \'undefined\' ? tags.join(\' \') : \'\'%>"/></td>\n                    </tr>\n                </table>\n            </div>\n    </div>\n</div>\n\n'}),define("text!templates/event_details/event.html",[],function(){return'<div class="summary">\n	<div class="picture">\n		<img src="<%= Assetics.asset(iconSet.icon) %>" width="128" height="128">\n	</div>\n	<div class="title_names">\n		<h1 class="ellipsis"><%= name %></h1>\n		<div class="names">\n			<span class="display_name ellipsis"><%= creator.personalDatas.displayedName %></span>\n			<span class="username ellipsis">(&gt;<%= creator.username %>)</span>\n		</div>\n		<% if(!isCreator) { %>\n			<% if(dropped) { %>\n				<div class="button in"><img src="<%= Assetics.staticAsset(img/check.png) %>">\n					<%= ExposeTranslation.get(\'button.added\') %>\n				</div>\n			<% } else { %>\n				<div class="button out"><img src="<%= Assetics.staticAsset(img/drop.png) %>">\n					<%= ExposeTranslation.get(\'button.add\') %>\n				</div>\n			<% } %>\n		<% } %>\n	</div>\n</div>\n<div class="details">\n	<dl>\n		<dt><%= ExposeTranslation.get(\'event.datetime.label\') %>:</dt>\n		<dd><%= date %></dd>\n	</dl>\n	<% if(typeof location !== \'undefined\' && location.place) { %>\n	<dl>\n		<dt><%= ExposeTranslation.get(\'event.place\') %>:</dt>\n		<dd><%= location.place %></dd>\n	</dl>\n	<% } %>\n</div>\n<hr>\n<% if(typeof details !== \'undefined\' && details) { %>\n<div class="description">\n	<p><%= ExposeTranslation.get(\'event.details_long\') %></p>\n	<div id="event_description">\n		<%= details %>\n	</div>\n</div>\n<% } %>\n'}),define("text!templates/timeline/timeline_event.html",[],function(){return'<div class="event clearfix" event-id="<%= id %>">\n    <div class="picture">\n        <img width="48" height="48" src="<%= Assetics.asset(iconSet.thumbnail) %>" alt="">\n    </div>\n    <div class="info">\n        <div class="datetime ellipsis"><%= startDateString %></div>\n        <div class="display_name ellipsis"><%= creator.personalDatas.displayedName %></div>\n        <div class="title ellipsis"><%= name %></div>\n    </div>\n    <% if(!isCreator) { %>\n        <span class="close"><img src="<%= Assetics.staticAsset(\'img/close.png\') %>"></span>\n    <% } %>\n</div>'}),define("text!templates/timeline/timeline.html",[],function(){return'<div id="timeline">\n<% for(var i in categories) { %>\n<div class="daybar"><%= categories[i] %></div>\n<% } %>\n</div>'}),define("text!templates/includes/single_user.html",[],function(){return'<div class="user">\n	<div class="picture">\n		<img src="<%= Assetics.asset(personalDatas.iconSet.icon) %>" width="64" height="64">\n	</div>\n	<div class="center_column">\n		<div class="names">\n			<span class="display_name ellipsis"><%= personalDatas.displayedName %></span>\n			<span class="username ellipsis">(&gt;<%= username %>)</span>\n		</div>\n		<% if(personalDatas.introduction) { %>\n        	<div class="introduce ellipsis"><%= personalDatas.introduction %></div>\n        <% } %>	\n	</div>\n	<% if(id != appUser.id) { %>\n		<div class="button_small drop drop_button button <%= dropped ? \'dropping\' : \'\' %>">\n			<img src="<%= Assetics.staticAsset(\'img/\' + (dropped ? \'check.png\' : \'drop.png\')) %>">\n			<span><%= ExposeTranslation.get(\'button.\' + (dropped ? \'dropping\' : \'drop\')) %></span>\n		</div>\n	<% } %>		\n</div>'}),define("text!templates/includes/single_user_small.html",[],function(){return'<div class="user clearfix">\n    <div class="picture">\n        <img width="32" height="32" src="<%= Assetics.asset(personalDatas.iconSet.thumbnail) %>" alt="">\n    </div>\n    <div class="info">\n        <div class="display_name ellipsis"><%= personalDatas.displayedName %></div>\n        <div class="button_small button drop <%= dropped ? \'dropping\' : \'\' %>">\n            <img src="<%= Assetics.staticAsset(dropped ? \'img/check.png\' : \'img/drop.png\') %>"/>\n            <span><%= ExposeTranslation.get(\'button.\' + (dropped ? \'dropping\' : \'drop\')) %></span>\n        </div>\n    </div>\n</div>'}),define("text!templates/user_details/user_infos.html",[],function(){return'<div class="picture">\n	<img src="<%= Assetics.asset(personalDatas.iconSet.icon) %>" width="128" height="128">\n</div>\n<div class="title_names">\n	<h1 class="ellipsis"><%= personalDatas.displayedName %></h1>\n	<span class="username ellipsis">(&gt;<%= username %>)</span>\n	<% if(personalDatas.introduction) { %>\n       	<div class="introduce ellipsis"><%= personalDatas.introduction %></div>\n       <% } %>\n	<% if(id != appUser.id) { %>\n	<div class="button_small drop drop_button button <%= dropped ? \'dropping\' : \'\' %>">\n		<img src="<%= Assetics.staticAsset(\'img/\' + (dropped ? \'check.png\' : \'drop.png\')) %>">\n		<span><%= ExposeTranslation.get(\'button.\' + (dropped ? \'dropping\' : \'drop\'))%></span>\n	</div>\n	<% } %>		\n</div>\n'}),define("text!templates/includes/single_event.html",[],function(){return'<div class="event">\n	<div class="picture">\n		<img src="<%= Assetics.asset(iconSet.icon) %>" width="64" height="64">\n	</div>\n	<div class="center_column">\n		<div class="datetime"><%= date %></div>\n		<div class="names">\n			<span class="display_name ellipsis"><%= creator.personalDatas.displayedName %></span>\n			<span class="username ellipsis">(&gt;<%= creator.username %>)</span>\n		</div>\n		<div class="title ellipsis"><%= name %></div>\n	</div>\n	<% if(!isCreator) { %>\n		<% if(dropped) { %>\n			<div class="button_small button drop in"><img src="<%= Assetics.staticAsset(\'img/check.png\') %>">\n				<span><%= ExposeTranslation.get(\'button.added\') %></span>\n			</div>\n		<% } else { %>\n			<div class="button_small button drop"><img src="<%= Assetics.staticAsset(\'img/drop.png\') %>">\n				<span><%= ExposeTranslation.get(\'button.add\') %></span>\n			</div>\n		<% } %>\n	<% } %>\n</div>'}),define("text!templates/user_event_tabs.html",[],function(){return'<div class="search scrollable">\n    <div class="buttons">\n        <span class="button_big white"><%= ExposeTranslation.get(\'common.back\') %></span>\n    </div>\n    <div id="search_result">\n        <div id="search_type_tab">\n            <ul>\n                <li class="user_tab">\n                    <a href="#user_tab">\n                        <span><%= ExposeTranslation.get(text.user) %></span>\n                    </a>\n                </li>\n                <li class="event_tab">\n                    <a href="#event_tab">\n                        <span><%= ExposeTranslation.get(text.event) %></span>\n                    </a>\n                </li>\n            </ul>\n        </div>\n        <div id="user_tab">\n        </div>\n        <div id="event_tab">\n        </div>\n    </div>\n</div>\n'}),define("text!templates/search_form.html",[],function(){return'<div id="search_form">\n    <table>\n        <tr>\n            <th>\n                <label for="keyword"><%= ExposeTranslation.get(\'search.keyword\') %></label>\n            </th>\n            <td>\n                <input type="text" id="search_keyword" placeholder="<%= ExposeTranslation.get(\'search.text\') %>" />\n            </td>\n        </tr>\n        <tr>\n            <th>\n                <label for="place"><%= ExposeTranslation.get(\'event.place\') %></label>\n            </th>\n            <td>\n                <input type="text" id="search_place" placeholder="<%= ExposeTranslation.get(\'search.place\') %>"/>\n            </td>\n        </tr>\n        <tr>\n            <th>\n                <label for="date"><%= ExposeTranslation.get(\'time.date\') %></label>\n            </th>\n            <td>\n                <input type="text" id="search_start_date" class="date datepicker" />\n                <span class="to">～</span>\n                <input type="text" id="search_end_date" class="date datepicker" />\n            </td>\n        </tr>\n    </table>\n    <div class="search_button">\n        <span id="search_button"><%= ExposeTranslation.get(\'search.search\') %></span>\n    </div>\n</div>'}),define("text!templates/calendar/calendar_event.html",[],function(){return"<div class=\"event_box ellipsis \n    <%= color.name %> <%= options.allDay ? ' all_day' : '' %> \n    <%= startDateTime.date < options.today ? ' passed' : ''%>\n    <%= options.preceded ? ' preceded' : '' %>\n    <%= options.followed ? ' followed' : '' %>\"\n    style=\"position: absolute; top: <%= options.top %>px; left: <%= options.left %>px;\n    width: <%= options.width %>px; height: <%= options.height %>px; \">\n<% if(!startDateTime.allDay && !options.preceded) { %>\n    <span><%= startDateTime.date.format('H:i') %></span>\n<% } %>\n    <span><%= name %></span>\n</div>"}),define("text!templates/event_details_popup.html",[],function(){return'<div id="event_summary_popup" class="popup">\n<table border="0" cellspacing="0" cellpadding="0">\n    <col style="width: 60px;">\n    <col style="width: 70px;">\n    <col style="width: 180px;">\n    <col style="width: 16px;">\n    <tbody>\n    <tr>\n        <td rowspan="4" class="picture">\n            <img width="48" height="48" \n                    src="<%= Assetics.asset(creator.personalDatas.iconSet.thumbnail) %>"/>\n        </td>\n        <td colspan="2" class="title"><p class="title ellipsis"><%= name %></p></td>\n        <td rowspan="4" class="close">\n        <a class="close">\n            <span class="csssprite close">close</span>\n        </a>        \n        </td>\n    </tr>\n    <tr>\n        <td class="label"><%= ExposeTranslation.get(\'time.date\') %></td>\n        <td class="value date ellipsis"><%= date %></td>\n    </tr>\n    <tr>\n        <td class="label"><%= ExposeTranslation.get(\'user.username\') %></td>\n        <td class="value creator ellipsis"><%= creator.username %></td>\n    </tr>\n    <% if(typeof location !== \'undefined\' && location.place) { %>\n    <tr>\n        <td class="label"><%= ExposeTranslation.get(\'event.place\') %></td>\n        <td class="value place ellipsis"><%= location.place %></td>\n    </tr>\n    <% } %>\n    </tbody>\n</table>\n    <div class="buttons">\n        <% if(isCreator) { %>\n            <span class="button drop button_small edit">\n                <span class="csssprite button_edit">button_edit</span>\n                <span><%= ExposeTranslation.get(\'button.edit\') %></span>\n            </span>\n            <span class="button drop  button_small delete">\n                <span class="csssprite button_delete">button_delete</span>\n                <span><%= ExposeTranslation.get(\'button.delete\') %></span>\n            </span>\n        <% } else { %>\n            <span class="button in toggle_drop">\n                <img src="<%= Assetics.staticAsset(\'img/check.png\') %>"/>\n                <span><%= ExposeTranslation.get(\'button.delete_from_calendar\') %></span>\n            </span>\n            <span class="button in" style="display:none;">\n                <span class="csssprite button_in">button_in</span>\n                <span><%= ExposeTranslation.get(\'button.in\') %></span>\n            </span>\n        <%  } %>\n        \n        <a class="setting_details">\n            <%= ExposeTranslation.get(\'common.details\') %>&nbsp;&gt;&gt;\n        </a>\n    </div>\n</div>\n'}),define("text!templates/includes/user_profile.html",[],function(){return'    <div class="picture">\n        <img width="48" height="48" src="<%= Assetics.asset(appUser.personalDatas.iconSet.icon) %>" alt="">\n    </div>\n    <div class="names">\n        <div class="display_name"><%= appUser.personalDatas.displayedName %></div>\n        <div class="username">&gt;<%= appUser.username %></div>\n    </div>\n'}),define("helpers/template_manager",["text!templates/calendar/calendar.html","text!templates/event_creation_popup.html","text!templates/event_creation.html","text!templates/event_details/event.html","text!templates/timeline/timeline_event.html","text!templates/timeline/timeline.html","text!templates/includes/single_user.html","text!templates/includes/single_user_small.html","text!templates/user_details/user_infos.html","text!templates/includes/single_event.html","text!templates/user_event_tabs.html","text!templates/search_form.html","text!templates/calendar/calendar_event.html","text!templates/event_details_popup.html","text!templates/includes/user_profile.html"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d){var v={getTemplate:function(e){switch(e){case"calendar":return this.getCalendarTemplate();case"event_creation_popup":return this.getEventCreationPopupTemplate();case"event_details_popup":return this.getEventDetailsPopupTemplate();case"event_creation":return this.getEventCreationTemplate();case"event_details":return this.getEventDetailsTemplate();case"single_user":return this.getSingleUserTemplate();case"timeline_event":return this.getTimelineEventTemplate();case"timeline":return this.getTimelineTemplate();case"single_user_small":return this.getSingleUserSmallTemplate();case"user_profile":return this.getUserProfileTemplate();case"single_event":return this.getSingleEventTemplate();case"user_event_tabs":return this.getUserEventTabsTemplate();case"search_form":return this.getSearchFormTemplate();case"calendar_event":return this.getCalendarEventTemplate();case"app_user_profile":return this.getAppUserProfileTemplate();default:throw new TemplateNotFoundException("Could not find template '"+e+"'.")}},getCalendarTemplate:function(){return e},getEventCreationPopupTemplate:function(){return t},getEventCreationTemplate:function(){return n},getEventDetailsTemplate:function(){return r},getSingleUserTemplate:function(){return o},getTimelineEventTemplate:function(){return i},getTimelineTemplate:function(){return s},getSingleUserSmallTemplate:function(){return u},getUserProfileTemplate:function(){return a},getSingleEventTemplate:function(){return f},getUserEventTabsTemplate:function(){return l},getSearchFormTemplate:function(){return c},getCalendarEventTemplate:function(){return h},getEventDetailsPopupTemplate:function(){return p},getAppUserProfileTemplate:function(){return d}};return v}),define("helpers/assets",["Underscore"],function(e){var t={};return t.st={},t.protocol="https",t.hostname="s3-ap-northeast-1.amazonaws.com",t.staticAsset=function(e){var n=t.st.protocol||"http",r=t.st.hostname||document.location.hostname,i=t.st.relativePath||"",s=t.st.port||80;i!==""&&(i+="/");var o=n.concat("://",r,":"+s,"/",i,e);return o},t.asset=function(e){var n=t.protocol||"http",r=t.hostname||document.location.hostname,i=t.relativePath||"",s=t.port||(n==="http"?80:443);i!==""&&(i+="/");var o=n.concat("://",r,":"+s,"/",i,e);return o},t.wrapAssetics=function(n){return e.extend({},n,{Assetics:t})},t}),define("views/main_panel/event_details",["jQuery","Underscore","Backbone","model/event","helpers/template_manager","event_manager","helpers/assets"],function(e,t,n,r,i,s,o){var u=n.View.extend({initialize:function(){this.model=new r,this.loaded=!1},el:"div#event",events:{"click div.event_username":"showUserDetails","click .button_big":"back","click span.button_small.edit":"editEvent","click span.button_small.delete":"deleteEvent","click span.button_small.drop":"toggleDrop","click div.event_description a":"openLink"},update:function(e){s.trigger("loading"),this.model.clear(),this.model.set("id",e);var t=this;this.model.fetch({success:function(e,n){s.trigger("endLoading"),s.trigger("loaded",t)}})},openLink:function(t){t.preventDefault();var n=e(t.target);window.open(n.attr("href"))},editEvent:function(e){s.trigger("editEvent",this.model)},deleteEvent:function(e){this.model.destroy(),s.trigger("changePage","top")},toggleDrop:function(){if(this.model.get("loading"))return;this.model.get("dropped")?s.trigger("undrop",this.model,this.$("span.button_small")):s.trigger("drop",this.model,this.$("span.button_small"))},template:t.template(i.getEventDetailsTemplate()),render:function(){return this.$("div.event_details").html(this.template(o.wrapAssetics(this.model.display()))),this},showUserDetails:function(e){e.stopPropagation(),e.preventDefault(),s.trigger("changePage","user",{username:this.model.get("creator").get("username")})},show:function(){this.render(),this.loaded=!0,this.$el.show()},closeEvent:function(e){this.model.undrop()},back:function(){s.trigger("back")}});return new u}),define("config",[],function(){return{}}),define("bootstrap",["jQuery","Underscore","config"],function(e,t,n){var r={};for(var i in n)n[i]=JSON.parse(n[i]);return t.extend(r,n),r}),define("app_user",["bootstrap","model/user"],function(e,t){var n=new t;return e.bootstrappedUser&&n.setFromJSON(e.bootstrappedUser),n}),define("views/main_panel/event_creation",["jQuery","Underscore","Backbone","model/event","helpers/template_manager","event_manager","app_user","helpers/assets"],function(e,t,n,r,i,s,o,u){var a=n.View.extend({tagName:"div",template:t.template(i.getEventCreationTemplate()),events:{"click span#create_button":"save","click span#back_button":"back","click input#event_allday":"setAllDay","click input#event_privacy":"handlePrivacy","keyup input#event_title":"handleTitle","keyup input#event_place":"handlePlace","keyup input#event_address":"handleAddress","keyup textarea#event_details":"handleDetails","click div#color_sample div":"handleColor","change input#event_start_date":"handleDate","change input#event_end_date":"handleDate","change input#event_start_time":"handleTime","change input#event_end_time":"handleTime"},initialize:function(){this.model=new r;var e=this.model.get("startDateTime").get("date"),t=this.model.get("endDateTime").get("date");this.timeDifference=new Date(t.getFullYear()-e.getFullYear()+1970,t.getMonth()-e.getMonth(),t.getDate()-e.getDate(),t.getHours()-e.getHours(),t.getMinutes()-e.getMinutes()),this.loading=!1},save:function(){if(this.model.isValid()&&!this.loading){s.trigger("loading");var e=this;this.model.save({},{success:function(t,n){s.trigger("endLoading"),s.trigger("success",ExposeTranslation.get("common.event_update_success")),s.trigger("back"),e.loading=!1}})}},handleDate:function(t){var n=e(t.target);n.blur();var r=n.val(),i=n.attr("id")==="event_start_date",s=i?"startDateTime":"endDateTime",o=/^([0-9]{4})\/([0-9]{2})\/([0-9]{2})$/.exec(r);if(!o)n.val(this.model.get(s).get("date").format("Y/m/d"));else{this.model.get(s).get("date").setFullYear(parseInt(o[1],10),parseInt(o[2],10)-1,parseInt(o[3],10));var u=this.model.get("startDateTime").get("date"),a=this.model.get("endDateTime").get("date");i?(a.setFullYear(u.getFullYear()+this.timeDifference.getYearFromZero(),u.getMonth()+this.timeDifference.getMonth(),u.getDate()+this.timeDifference.getDate()),this.$("input#event_end_date").val(a.format("Y/m/d"))):(a<u?u.setFullYear(a.getFullYear()-this.timeDifference.getYearFromZero(),a.getMonth()-this.timeDifference.getMonth(),a.getDate()-this.timeDifference.getDate()):this.timeDifference=new Date(a-u),this.$("input#event_start_date").val(u.format("Y/m/d")))}},handleTime:function(t){var n=e(t.target),r=n.val();n.blur();var i=n.attr("id")==="event_start_time",s=i?"startDateTime":"endDateTime",o=/^([0-9]{2}):([0-9]{2})$/.exec(r);if(!o)n.val(this.model.get(s).get("date").format("H:i"));else{var u=new Date(this.model.get("endDateTime").get("date"));this.model.get(s).get("date").setHours(parseInt(o[1],10),parseInt(o[2],10));var a=this.model.get("startDateTime").get("date"),f=this.model.get("endDateTime").get("date");i?(f.setHours(a.getHours()+this.timeDifference.getHours(),a.getMinutes()+this.timeDifference.getMinutes()),this.$("#event_end_time").val(f.format("H:i"))):f<a?(this.model.get("endDateTime").get("date").setHours(u.getHours(),u.getMinutes()),this.$("#event_end_time").val(f.format("H:i"))):this.timeDifference=new Date(f-a)}},handleTitle:function(t){var n=this.model.set("name",e(t.target).val())},handlePlace:function(t){var n=this.model.set("location",{place:e(t.target).val()})},handleAddress:function(t){var n=this.model.set("address",e(t.target).val())},handleDetails:function(t){var n=this.model.set("details",e(t.target).val())},handleColor:function(t){this.$("div#color_sample div").removeClass("clicked");var n=e(t.target),r=this.model.set("color",{name:n.attr("class")});n.addClass("clicked")},resetModel:function(){this.model.clear(),this.model.initialize(),this.render()},setModel:function(e){this.model=e,this.render()},render:function(){return this.$el.html(this.template(u.wrapAssetics(t.extend({},{appUser:o},this.model.getObject())))),this.$("#event_start_time").timePicker(),this.endTimePicker=this.$("#event_end_time").timePicker(),this.$(".datepicker").datepicker({dateFormat:"yy/mm/dd"}),this.$("input[placeholder]").placeholder(),this},back:function(){s.trigger("back")},handlePrivacy:function(t){this.model.set("privacySettings",{visibility:e(t.target).val()})},show:function(){this.loaded=!0,this.$el.show()},setAllDay:function(t){var n=e(t.target),r=n.is(":checked");this.model.get("startDateTime").set("allDay",r),this.model.get("endDateTime").set("allDay",r),n.blur(),this.$("input.time").toggle(!r)}});return new a}),define("views/calendar/popup",["jQuery","Underscore","Backbone","event_manager"],function(e,t,n,r){var i=n.View.extend({initialize:function(e){this.$el=e},events:{"click a.close":"close","click div":"stopPropagation"},open:function(t,n){e("#event_summary_popup").hide(),e("#make_event_popup").hide(),this.setPosition(t,n),this.$el.children("div").show();var r=this;e("body").click(function(){r.close.call(r)})},close:function(e){typeof e!="undefined"&&e.preventDefault(),this.$el.children("div").hide()},setPosition:function(e,t){var n=this.$el.children("div"),r=n.innerWidth(),i=n.innerHeight(),s=30,o=document.documentElement.clientWidth||document.body.clientWidth||document.body.scrollWidth;t-i>0?n.css("top",t-i):n.css("top",t),e+r/2+s<=o?n.css("left",e-r/2):n.css("left",brouserWidth-r-s)},toDetails:function(){this.close(),r.trigger("editEvent",this.model)},stopPropagation:function(e){e.stopPropagation()}});return i}),define("views/calendar/event_details_popup",["jQuery","Underscore","Backbone","views/calendar/popup","model/event","helpers/template_manager","event_manager","helpers/assets"],function(e,t,n,r,i,s,o,u){var a=r.extend({initialize:function(){this.events=t.extend({},r.prototype.events,this.events),r.prototype.initialize(this.$el),this.displayed=!1},template:t.template(s.getEventDetailsPopupTemplate()),setModel:function(e){this.model=e},events:{"click a.setting_details":"showEvent","click span.button_small.edit":"editEvent","click span.button_small.delete":"deleteEvent","click span.button_small.toggle_drop":"toggleDrop","click span.button_small.in":"outOfCalendar"},editEvent:function(e){this.close(),o.trigger("editEvent",this.model)},deleteEvent:function(e){this.close(),this.model.trigger("out"),this.model.destroy()},toggleDrop:function(){if(this.model.get("loading"))return;this.model.get("dropped")?o.trigger("undrop",this.model,this.$("span.button_small.drop")):o.trigger("drop",this.model,this.$("span.button_small.drop")),this.close(),this.model.trigger("out")},outOfCalendar:function(){this.close(),this.model.outOfCalendar(),this.model.trigger("out")},render:function(){return this.$el.html(this.template(u.wrapAssetics(this.model.display()))),this.delegateEvents(this.events),this},showEvent:function(e){e.preventDefault(),this.close(),o.trigger("changePage","event",{id:this.model.get("id")})}});return new a}),define("views/calendar/calendar_event",["jQuery","Underscore","Backbone","views/calendar/event_details_popup","helpers/template_manager","helpers/assets"],function(e,t,n,r,i,s){var o=n.View.extend({tagName:"div",initialize:function(){this.height=16;var e=this;this.model.on("out",function(){e.remove()})},events:{click:"showDetailsPopup"},template:t.template(i.getCalendarEventTemplate()),display:function(e){var n=this.model.display(),r=t.extend(n,{options:{today:Date.getToday(),showTime:e.showTime,top:e.top+e.eventsAbove*(this.height+2),width:e.width,height:this.height,left:e.left,preceded:e.preceded,followed:e.followed,allDay:e.allDay}});return this.$el.append(this.template(s.wrapAssetics(r))),this},showDetailsPopup:function(t){t.stopPropagation(),r.setModel(this.model),r.render(),r.displayed||e("div#body").append(r.el),r.open(t.pageX,t.pageY)}});return o}),define("views/calendar/event_creation_popup",["jQuery","Underscore","Backbone","views/calendar/popup","model/event","helpers/template_manager","event_manager","helpers/assets"],function(e,t,n,r,i,s,o,u){var a=r.extend({initialize:function(){this.date=new Date,this.events=t.extend({},r.prototype.events,this.events),this.keyPressCount=0,r.prototype.initialize(this.$el)},template:t.template(s.getEventCreationPopupTemplate()),events:{"keyup input.title":"updateModel","keypress input.title":"increaseKeyPressCount","click span.button_big":"saveAndQuit","click a.setting_details":"toDetails"},increaseKeyPressCount:function(e){var t=e.which||e.keycode;t!==241&&t!==242&&this.keyPressCount++},setDate:function(e){var t=Date.parse(e);t=isNaN(t)?new Date:new Date(t),this.date=t},updateModel:function(t){var n=t.which||t.keycode;t.preventDefault(),this.model.set("name",e(t.target).val()),this.keyPressCount--,this.keyPressCount<0?this.keyPressCount=0:(this.model.set("name",e(t.target).val()),n===13&&this.saveAndQuit())},saveAndQuit:function(){this.close(),this.model.set("name",this.$("input.title").val()),this.model.save({},{success:function(){o.trigger("success",ExposeTranslation.get("common.event_update_success"))}})},render:function(){this.model=new i;var e=this.model.get("startDateTime").get("date"),t=this.model.get("endDateTime").get("date");return e.setFullYear(this.date.getFullYear(),this.date.getMonth(),this.date.getDate()),t.setFullYear(this.date.getFullYear(),this.date.getMonth(),this.date.getDate()),this.$el.html(this.template(u.wrapAssetics({date:this.date}))),this.delegateEvents(this.events),this}});return new a}),define("collections/calendar_events",["jQuery","Underscore","Backbone","model/event","event_manager","bootstrap"],function(e,t,n,r,i,s){var o=n.Collection.extend({model:r,initialize:function(){this.date=new Date,this.params={},s.bootstrappedCalendar&&this.setFromJSON(s.bootstrappedCalendar),i.on("calendarAdd",this.silentAdd,this),i.on("outOfCalendar",this.silentRemove,this)},setFromJSON:function(e){for(var t in e){var n=new r;n.setFromJSON(e[t]),this.add(n,{silent:!0})}this.trigger("reset")},getParams:function(){var e=t.extend(this.params,{start:this.date.firstDateToDisplay().format("Y-m-d"),end:this.date.lastDateToDisplay().format("Y-m-d")});return e},silentAdd:function(e){this.add(e,{silent:!0}),this.trigger("add")},silentRemove:function(e){this.remove(e,{silent:!0}),this.trigger("remove")},comparator:function(e,t){return-1*e.compareDates(t)},routeList:{read:"droppy_event_ajax_interval"},getEventsInMonth:function(){var e=this.date.firstDateToDisplay(),t=this.date.lastDateToDisplay();return this.filter(function(n){return n.get("endDateTime").get("date")>=e&&n.get("startDateTime").get("date")<=t})},getEventsNumberOnDate:function(e){return this.filter(function(t){return t.printed&&(e.dateEquals(t.get("startDateTime").get("date"))||t.get("endDateTime").get("date")>=e&&t.get("startDateTime").get("date")<=e)}).length},resetPrintedStatus:function(){this.map(function(e){e.printed=!1})},setDate:function(e){this.date=e},sync:function(e,t,r){var i=this.getParams();return r.url=Routing.generate(this.routeList[e],i),n.sync(e,t,r)}});return new o}),define("views/calendar/calendar",["jQuery","Underscore","Backbone","views/calendar/calendar_event","helpers/template_manager","views/calendar/event_creation_popup","collections/calendar_events","event_manager","helpers/assets"],function(e,t,n,r,i,s,o,u,a){var f=n.View.extend({template:t.template(i.getCalendarTemplate()),initialize:function(){this.date=new Date,this.calendarEvents=o,this.startListening(),this.views=[],this.thisMonthEnabled=!1,this.mouseWheelActive=!1,e("div#body").append(s.render().el)},startListening:function(){this.calendarEvents.bind("add",this.addAll,this),this.calendarEvents.bind("reset",this.addAll,this),this.calendarEvents.bind("remove",this.addAll,this),u.on("resize",this.resize,this),u.on("calendarChange",this.addAll,this),u.on("calendarUpdate",this.updateDatas,this),u.on("calendarReset",this.resetCalendar,this)},events:{"click span.calendar_button.prev":"lastMonth","click span.calendar_button.next":"nextMonth","click span.calendar_button.current":"thisMonth","mousemove table.calendar tbody":"colorCell","mouseleave table.calendar tbody":"uncolorCell","click div.calendar td":"showEventCreationPopup","mousewheel div.calendar tbody":"changeMonth"},changeMonth:function(e,t){if(this.mouseWheelActive)return;t>0?this.lastMonth():this.nextMonth(),this.mouseWheelActive=!0;var n=this;setTimeout(function(){n.mouseWheelActive=!1},200)},resize:function(){var t=e(window).height(),n=e("div#header").height(),r=this.$("div.calendar_tools").height(),i=this.$("table.calendar"),s=i.find("thead tr").height(),o=t-n-r-s,u=i.children("tbody");u.height(o);var a=u.children("tr").filter(":visible");a.height(o/a.length),this.addAll()},setDate:function(e){this.date=e},update:function(e){this.updateDatas(),this.updateView(e)},updateDatas:function(){var e=this,t=this.calendarEvents;t.setDate(this.date),this.firstDay=this.date.firstDateToDisplay(),this.lastDay=this.date.lastDateToDisplay(),u.trigger("loading"),t.fetch({add:!0,silent:!0,success:function(){e.addAll(),u.trigger("endLoading")}})},lastMonth:function(){this.date.setMonth(this.date.getMonth()-1),this.update(!0)},nextMonth:function(){this.date.setMonth(this.date.getMonth()+1),this.update(!0)},thisMonth:function(){this.thisMonthEnabled&&(this.date=new Date,this.update(!0))},updateView:function(e){this.updateButtonsView(),this.updateCalendarView(),e&&(this.date.sameMonth(new Date)?u.trigger("pageChanged","top"):u.trigger("pageChanged","calendar",{date:this.date.format("Y-m")}))},resetCalendar:function(){this.calendarEvents.reset([],{silent:!0}),this.updateDatas()},updateButtonsView:function(){var e=this.$("div.calendar_tools tr");e.find("td.date").text(this.date.format(ExposeTranslation.get("time.year_month")));var t=e.find("td.right span.current");this.date.sameMonth(new Date)?(t.addClass("disabled"),this.thisMonthEnabled=!1):(t.removeClass("disabled"),this.thisMonthEnabled=!0)},updateCalendarView:function(){var e=this.date.firstDateToDisplay(),t=this.date.daysToDisplay(),n=this.$("table.calendar tbody tr");n.hide();var r=n.first();for(var i=0;i<t/7;i++){var s=r.children("td").first();for(var o=0;o<7;o++)s.attr("id",e.format("Y-m-d")),s.attr("class",e.getClassName(this.date)),s.children("p").text(e.getDate()),s=s.next(),e.setDate(e.getDate()+1);r.show(),r=r.next()}},render:function(){return this.$el.html(this.template()),this},show:function(){this.loaded=!0,this.update(),this.$el.show()},addOne:function(e){var n=new r({model:e}),i=e.get("startDateTime").get("date");i=this.firstDay>i?new Date(this.firstDay):new Date(i);var s=e.get("endDateTime").get("date");s=this.lastDay<s?new Date(this.lastDay):new Date(s);var o={eventsAbove:this.calendarEvents.getEventsNumberOnDate(i),preceded:!i.dateEquals(e.get("startDateTime").get("date"))},u=this.$(".calendar tbody td"),a=Math.floor((u.height()-u.children("p").outerHeight(!0))/(n.height+2));if(o.eventsAbove>=a)return;o.allDay=e.get("startDateTime").get("allDay")||!i.dateEquals(s);while(i<=s){var f=Math.min(s.getDaysDifference(i),i.toLastDayOfWeek()),l=i.fromFirstDayOfWeek(),c=i.rowsFromFirstDisplayedDay(0,this.date);i.setDate(i.getDate()+f),o.followed=i<=s;var h=t.extend(this.getCellInfos(f,c,l,e.get("startDateTime").get("allDay")),o);n.display(h),o.preceded=!0}e.printed=!0,this.$("table.calendar tbody").append(n.render().el),this.views.push(n)},getCellInfos:function(e,t,n,r){var i=this.$("table.calendar tbody"),s=i.find("tr").eq(t),o=s.find("td").eq(n),u=o.offset(),a=r?1:0,f=s.find("td").eq(n+e-1),l=f.offset().left+f.innerWidth()-2*a;return{top:u.top+o.children("p").outerHeight(!0),left:u.left,width:l-u.left}},addAll:function(){for(var e in this.views)this.views[e].remove();this.view=[],this.calendarEvents.resetPrintedStatus();var t=this.calendarEvents.getEventsInMonth();for(var e=0;e<t.length;e++){var n=t[e];n.get("dropped")&&n.get("inCalendar")&&this.addOne(n)}},colorCell:function(t){this.$("td.hover").removeClass("hover");var n=this.$("table.calendar tbody").offset(),r={top:t.clientY-n.top+e(window).scrollTop(),left:t.clientX-n.left},i={height:this.$("table.calendar td").outerHeight(),width:this.$("table.calendar td").outerWidth()};numberOfCell=Math.min(Math.floor((1+r.left)/i.width),6),numberOfCell+=7*Math.floor(r.top/i.height),this.$("table.calendar").find("td").eq(numberOfCell).addClass("hover")},showEventCreationPopup:function(t){t.stopPropagation();var n=e(t.target);n.is("p")&&(n=n.parent("td")),s.setDate(n.attr("id")),s.render(),s.open(t.pageX,t.pageY),s.$("input.title").focus()},uncolorCell:function(){this.$("td.hover").removeClass("hover")}});return new f}),define("collections/user_list",["jQuery","Underscore","Backbone","model/user"],function(e,t,n,r){var i=n.Collection.extend({model:r,initialize:function(){this.allLoaded=!1,this.loading=!1,typeof this.params=="undefined"&&(this.params={})},loadMore:function(){if(this.loading||this.allLoaded)return;t.extend(this.params,{offset:this.length}),this.loading=!0;var e=this;this.fetch({add:!0,success:function(t,n){e.loading=!1,n.length===0&&(e.allLoaded=!0)}})},sync:function(e,t,r){var i="params"in this?this.params:{};return r.url=Routing.generate(this.routeList[e],i),n.sync(e,t,r)}});return i}),define("views/includes/single_user",["jQuery","Underscore","Backbone","helpers/template_manager","event_manager","app_user","helpers/assets"],function(e,t,n,r,i,s,o){var u=n.View.extend({tagName:"div",initialize:function(){this.template=t.template(r.getTemplate(this.options.templateName))},events:{"click div.names":"showUser","click div.button_small":"toggleDrop"},render:function(){return this.$el.html(this.template(o.wrapAssetics(t.extend({},{appUser:s.toJSON()},this.model.toJSON())))),this},showUser:function(e){e.preventDefault(),i.trigger("changePage","user",{username:this.model.get("username")})},toggleDrop:function(t){$target=e(t.target),$target.is("div")||($target=$target.parent());if(this.model.get("loading"))return;this.model.get("dropped")?i.trigger("undrop",this.model,$target,!0):i.trigger("drop",this.model,$target,!0)}});return u}),define("views/general/user_list",["jQuery","Underscore","Backbone","views/includes/single_user","event_manager","helpers/assets"],function(e,t,n,r,i,s){var o=n.View.extend({initialize:function(){var t=e("<div />").attr("class","loading centering").append(e("<img />").attr("src",s.staticAsset("img/loading_big.gif")));this.$el.append(t),this.userList=this.options.userList,this.templateName=this.options.templateName,this.userList.bind("add",this.addOne,this),this.userList.bind("reset",this.addAll,this),i.trigger("loading"),this.userList.fetch({success:function(){i.trigger("endLoading")}})},addOne:function(e){var t=new r({model:e,templateName:this.templateName});this.$el.append(t.render().el)},addAll:function(){this.$(".loading").remove(),this.$("div").remove();for(var e=0;e<this.userList.length;e++)this.addOne(this.userList.at(e))}});return o}),define("collections/event_list",["jQuery","Underscore","Backbone","model/event"],function(e,t,n,r){var i=n.Collection.extend({model:r,initialize:function(){this.allLoaded=!1,this.loading=!1,typeof this.params=="undefined"&&(this.params={})},setFromJSON:function(e){for(var t in e){var n=new r;n.setFromJSON(e[t]),this.add(n,{silent:!0})}this.trigger("reset")},comparator:function(e,t){return-1*e.compareDates(t)},loadMore:function(){if(this.loading||this.allLoaded)return;t.extend(this.params,{offset:this.length}),this.loading=!0;var e=this;this.fetch({add:!0,success:function(t,n){e.loading=!1,n.length===0&&(e.allLoaded=!0)}})},sync:function(e,t,r){var i="params"in this?this.params:{};return r.url=Routing.generate(this.routeList[e],i),n.sync(e,t,r)}});return i.fromJSON=function(e){return t.map(e,function(e){var t=new r;return t.setFromJSON(e),t})},i}),define("views/includes/single_event",["jQuery","Underscore","Backbone","helpers/template_manager","event_manager","helpers/assets"],function(e,t,n,r,i,s){var o=n.View.extend({tagName:"div",initialize:function(){this.showCreator=typeof this.options.showCreator!="undefined"?this.options.showCreator:!0,this.template=t.template(r.getTemplate(this.options.templateName))},events:{"click div.title":"showEvent","click span.edit":"editEvent","click span.delete":"deleteEvent","click div.button_small":"toggleDrop","click p.user":"showUser"},render:function(){var e=this.model.display();return e.options={showCreator:this.showCreator},this.$el.html(this.template(s.wrapAssetics(e))),this},toggleDrop:function(t){$target=e(t.target),$target.is("div")||($target=$target.parent());if(this.model.get("loading"))return;this.model.get("dropped")?i.trigger("undrop",this.model,$target,!1):i.trigger("drop",this.model,$target,!1)},showEvent:function(e){e.preventDefault(),i.trigger("changePage","event",{id:this.model.get("id")})},editEvent:function(e){i.trigger("editEvent",this.model)},deleteEvent:function(e){this.model.destroy(),this.$el.remove()},showUser:function(e){e.preventDefault(),i.trigger("changePage","user",{username:this.model.get("creator").get("username")})}});return o}),define("views/general/event_list",["jQuery","Underscore","Backbone","views/includes/single_event","event_manager","helpers/assets"],function(e,t,n,r,i,s){var o=n.View.extend({initialize:function(){var t=e("<div />").attr("class","loading centering").append(e("<img />").attr("src",s.staticAsset("img/loading_big.gif")));this.$el.append(t),this.eventList=this.options.eventList,this.templateName=this.options.templateName,this.showCreator=typeof this.options.showCreator!="undefined"?this.options.showCreator:!0,this.eventList.bind("add",this.addOne,this),this.eventList.bind("reset",this.addAll,this),i.trigger("loading"),this.eventList.fetch({success:function(){i.trigger("endLoading")}})},addOne:function(e){var t=new r({model:e,templateName:this.templateName,showCreator:this.showCreator});this.$el.append(t.render().el)},addAll:function(){this.$el.empty();for(var e=0;e<this.eventList.length;e++)this.addOne(this.eventList.at(e))}});return o}),define("views/main_panel/user_profile",["jQuery","Underscore","Backbone","model/user","collections/user_list","views/general/user_list","collections/event_list","views/general/event_list","helpers/template_manager","event_manager","app_user","helpers/assets"],function(e,t,n,r,i,s,o,u,a,f,l,c){var h=n.View.extend({initialize:function(){this.model=new r,this.loaded=!1},el:"div#user",template:t.template(a.getUserProfileTemplate()),initCreatedEvents:function(){this.eventList=new o,t.extend(this.eventList,{routeList:{read:"droppy_event_ajax_created_events"},params:{user_id:this.model.get("id")}}),new u({eventList:this.eventList,templateName:"single_event",el:"div#created div.eventlist",showCreator:!1})},initDroppings:function(){this.droppings=new i,t.extend(this.droppings,{routeList:{read:"droppy_user_ajax_dropping_users"},params:{user_id:this.model.get("id")},comparator:function(e){return e.get("droppingUsersNumber")}}),new s({userList:this.droppings,templateName:"single_user",el:"div#dropping  div.userlist"})},render:function(){return this.$("div.summary").html(this.template(c.wrapAssetics(t.extend({appUser:l.toJSON()},this.model.toJSON())))),this},initElements:function(){this.$tabs=this.$("div#tabs").tabs(),this.$el.jScrollPane({verticalGutter:0,autoReinitialise:!0,contentWidth:"0px"})},events:{"click .button_big":"back","focus div#user_details":"blur","click div.title_names div.button.drop":"toggleDrop","click div.title_names div.introduce":"openLink","jsp-scroll-y":"loadMore"},openLink:function(t){t.preventDefault();var n=e(t.target);window.open(n.attr("href"))},loadMore:function(e,t,n,r){if(r){var i=this.$tabs.tabs("option","selected"),s=[this.droppings,this.eventList];s[i].loadMore()}},blur:function(){this.$("div#user_details").blur()},toggleDrop:function(t){$target=e(t.target),$target.is("div")||($target=$target.parent());if(this.model.get("loading"))return;this.model.get("dropped")?f.trigger("undrop",this.model,$target,!0):f.trigger("drop",this.model,$target,!0)},update:function(e){f.trigger("loading"),this.model.clear(),this.model.set("username",e);var t=this;this.model.fetch({success:function(e,n){f.trigger("endLoading"),f.trigger("loaded",t),t.initDroppings(),t.initCreatedEvents()}})},show:function(){this.render(),this.$el.show(),this.initElements(),this.loaded=!0},back:function(){f.trigger("back")}});return new h}),define("views/main_panel/recommendations",["jQuery","Underscore","Backbone","collections/user_list","views/general/user_list","collections/event_list","views/general/event_list","helpers/template_manager","event_manager","helpers/assets"],function(e,t,n,r,i,s,o,u,a,f){var l=n.View.extend({initialize:function(){this.loaded=!1,this.eventParams={},this.userParams={},this.templateText={user:"user.recommended_users",event:"event.recommended_events"}},getEventRouteList:function(){return{read:"droppy_event_ajax_latest_events"}},getUserRouteList:function(){return{read:"droppy_user_ajax_aetelrecommended_users"}},initEventList:function(){this.eventList=new s,t.extend(this.eventList,{routeList:this.getEventRouteList(),params:this.eventParams}),new o({eventList:this.eventList,templateName:"single_event",el:"div#event_tab"})},initUserList:function(){this.userList=new r,t.extend(this.userList,{routeList:this.getUserRouteList(),comparator:function(e){return e.get("username")},params:this.userParams}),new i({userList:this.userList,templateName:"single_user_new",el:"div.userlist"})},initElements:function(){this.$("#search_result").tabs({fx:{opacity:"toggle",duration:"fast"}}),this.$(".scrollable").jScrollPane({verticalGutter:0,autoReinitialise:!0})},events:{"click .button_big":"back","focus div.search":"blur"},blur:function(){this.$("div.search").blur()},template:t.template(u.getUserEventTabsTemplate()),render:function(){return this.$el.html(this.template(f.wrapAssetics({text:this.templateText}))),this},show:function(){this.render(),this.$el.show(),this.$("div.search").height(e(window).height()-e("div#header").height()),this.initElements(),this.initEventList(),this.initUserList(),this.loaded=!0},back:function(){a.trigger("back")}});return l}),define("views/main_panel/search",["jQuery","Underscore","Backbone","views/main_panel/recommendations","collections/user_list","views/general/user_list","collections/event_list","views/general/event_list","helpers/template_manager","helpers/assets","event_manager"],function(e,t,n,r,i,s,o,u,a,f,l){var c=n.View.extend({initialize:function(){this.loaded=!1,this.userParams={}},el:"div#search",events:{"click .button_big":"back"},makeSearch:function(){this.userList.params=this.userParams,this.userList.fetch()},getUserRouteList:function(){return{read:"droppy_user_ajax_search_users"}},search:function(e){this.userParams={keywords:e}},initUserList:function(){this.userList=new i,t.extend(this.userList,{routeList:this.getUserRouteList(),comparator:function(e){return e.get("username")},params:this.userParams}),new s({userList:this.userList,templateName:"single_user",el:"div.userlist"}),this.userList.on("reset",this.showResults,this)},showResults:function(){this.$("div.userlist").show(),this.$("span.result.before").hide(),this.$("span.result.after").text(ExposeTranslation.get("search.user_result",{number:this.userList.length}))},initElements:function(){this.$el.jScrollPane({verticalGutter:0,autoReinitialise:!0})},show:function(){this.$el.show(),this.$("div#search").height(e(window).height()-e("div#header").height()),this.initElements(),this.initUserList(),this.loaded=!0},back:function(){l.trigger("back")}});return new c}),define("router",["jQuery","Underscore","Backbone","views/main_panel/event_details","views/main_panel/event_creation","views/calendar/calendar","views/main_panel/user_profile","views/main_panel/recommendations","views/main_panel/search","event_manager"],function(e,t,n,r,i,s,o,u,a,f){var l=n.Router.extend({initialize:function(){this.recommendationsView=new u,this.route(/^!\/([0-9]{4}-[0-9]{2})$/,"showCalendar"),this.calendar=s,f.on("editEvent",this.createEvent,this)},routes:{"!/create-event":"createEvent","!/recommendations":"showRecommendations","!/event/:id":"showEvent","!/:username":"showUser","!/search/:keyword":"search","*path":"showCalendar"},routesInfos:{event_creation:{route:"create-event"},calendar:{route:":date",parameters:{date:/[0-9]{4}-[0-9]{2}/}},event:{route:"event/:id",parameters:{id:/[0-9]+/}},user:{route:":username",parameters:{username:/[a-zA-Z0-9_]+/}},recommendations:{route:"recommendations"},search:{route:"search/:keyword",parameters:{keyword:/.*/}},top:{route:""}},getDefaultRoute:function(){return this.routesInfos.top},showEvent:function(e){r.update(e)},showUser:function(e){o.update(e)},search:function(e){a.search(e),f.trigger("loaded",a)},generateRoute:function(e,t){t=t||{};var n=this.routesInfos[e]||this.getDefaultRoute(),r=n.parameters,i=n.route;for(var s in r){if(!(s in t)||!r[s].exec(t[s]))return!1;i=i.replace(":"+s,t[s])}return"!/"+i},showRecommendations:function(){f.trigger("loaded",this.recommendationsView)},createEvent:function(e){typeof e=="undefined"?i.resetModel():i.setModel(e),this.navigate(this.generateRoute("event_creation")),f.trigger("loaded",i)},showCalendar:function(e){e=e||"";var t=new Date(Date.parse(e));isNaN(t.getTime())&&(t=new Date),s.setDate(t),f.trigger("loaded",s)}}),c=function(){var e=new l;return n.history.start(),e};return{initialize:c}}),define("views/timeline/timeline_event",["jQuery","Underscore","Backbone","helpers/template_manager","event_manager","helpers/assets"],function(e,t,n,r,i,s){var o=n.View.extend({tagName:"div",initialize:function(){this.model.on("remove",this.remove,this)},template:t.template(r.getTimelineEventTemplate()),events:{"click div.event":"showDetails","click a.close":"closeEvent","click div.info div.display_name":"showProfile","mouseenter div.event":"showClose","mouseleave div.event":"hideClose"},render:function(){return this.$el.html(this.template(s.wrapAssetics(this.model.display()))),this},showClose:function(){this.$("a.close").show()},hideClose:function(){this.$("a.close").hide()},showDetails:function(e){e.stopPropagation(),i.trigger("changePage","event",{id:this.model.get("id")})},showProfile:function(e){e.preventDefault(),e.stopPropagation(),i.trigger("changePage","user",{username:this.model.get("creator").get("username")})},closeEvent:function(e){e.preventDefault(),e.stopPropagation(),this.model.undrop(),this.remove()},remove:function(){var e=this.$el.parent("div");this.$el.remove(),e.find("div").not(".daybar").length===0&&e.hide()}});return o}),define("views/timeline/timeline",["jQuery","Underscore","Backbone","views/timeline/timeline_event","event_manager","helpers/assets"],function(e,t,n,r,i,s){var o=n.View.extend({el:"div#timeline",events:{"focus div.event_lists":"blur","jsp-scroll-y .scrollable":"loadMore"},initialize:function(e){this.views=[],this.scrollPane=this.$el.jScrollPane({verticalGutter:0,autoReinitialise:!0,scrollbarMargin:0}),this.timeline=e,i.on("timelineAdd",this.timeline.add,this.timeline),i.on("outOfTimeline",this.timeline.remove,this.timeline),this.timeline.bind("add",this.addOne,this),this.timeline.bind("reset",this.addAll,this)},loadMore:function(e,t,n,r){r&&this.timeline.loadMore()},blur:function(t){e(t.target).blur()},addOne:function(e,t,n){var i=new r({model:e});container=this.scrollPane,api=container.data("jsp"),contentPane=api.getContentPane();var s=e.timelineCategory(),o=contentPane.find("div."+s);this.views.push(i);var u=i.render().el;if(n.append||typeof n.index=="undefined")o.append(u);else if(n.index===0)o.children().after(u);else{var a=this.timeline.at(n.index-1).get("id"),f=o.find('div[event-id="'+a+'"]').parent();f.length===0?o.children(".daybar").after(u):f.after(u)}o.show()},addAll:function(){this.$el.find(".loading").remove(),this.$el.find("div.timeline_container div").not(".daybar").remove(),this.$el.find("div.timeline_container").hide();for(var e=0;e<this.timeline.length;e++)this.addOne(this.timeline.at(e),{},{append:!0})}});return o}),define("data_manager",["jQuery","Underscore","Backbone","collections/event_list","views/timeline/timeline","collections/user_list","views/general/user_list","event_manager","bootstrap","helpers/assets"],function(e,t,n,r,i,s,o,u,a,f){var l=function(){this.initialize()};return l.prototype={initialize:function(){this.timeline=new r,t.extend(this.timeline,{routeList:{read:"droppy_event_ajax_timeline"}}),new i(this.timeline),a.bootstrappedTimeline&&this.timeline.setFromJSON(a.bootstrappedTimeline),this.initRecommendedUsers(),this.initEvents()},initEvents:function(){u.on("drop",this.drop,this),u.on("undrop",this.undrop,this),u.on("eventUpdate",this.addToTimeline,this),u.on("eventRemoved",this.removeFromTimeline,this)},addToTimeline:function(e){this.timeline.add(e)},initRecommendedUsers:function(){this.recommendedUsers=new s,t.extend(this.recommendedUsers,{routeList:{read:"droppy_user_ajax_isobeselected_users"},comparator:function(e){return e.get("droppersNumber")}}),new o({userList:this.recommendedUsers,templateName:"single_user_small",el:"div.recommended_users"})},drop:function(e,t,n){var i=this;t.children("img").attr("src",f.staticAsset("img/loading.gif")),e.set("loading",!0),e.drop({success:function(i){t.addClass(n?"dropping":"in"),t.children("img").attr("src",f.staticAsset("img/check.png")),t.children("span").text(ExposeTranslation.get(n?"button.dropping":"button.added")),e.set("dropped",!0),e.set("loading",!1);if(Array.isArray(i)){var s=r.fromJSON(i);u.trigger("timelineAdd",s),u.trigger("calendarAdd",s)}}})},undrop:function(e,t,n){var i=this;t.children("img").attr("src",f.staticAsset("img/loading_undrop.gif")),e.set("loading",!0),e.undrop({success:function(i){t.removeClass(n?"dropping":"in"),t.children("img").attr("src",f.staticAsset("img/drop.png")),t.children("span").text(ExposeTranslation.get(n?"button.drop":"button.add")),e.set("dropped",!1),e.set("loading",!1);if(Array.isArray(i)){var s=r.fromJSON(i);u.trigger("outOfCalendar",s),u.trigger("outOfTimeline",s)}}})}},l}),define("views/top_message",["jQuery","Underscore","Backbone"],function(e,t,n){var r=n.View.extend({el:e("div#top_message"),initialize:function(){this.className=""},showTopMessage:function(e,t,n){t=t||5e3;var r=this.$el;r.attr("class",n),this.className=n,r.children("p").text(e),r.show(),t>=0&&setTimeout(function(){r.fadeOut()},t)},hideTopMessage:function(){this.$el.fadeOut("fast")},hideLoading:function(){this.className==="information"&&this.hideTopMessage()},showError:function(e,t){this.hideTopMessage(),e=e||ExposeTranslation.get("error.general"),this.showTopMessage(e,t,"error")},showInformationMessage:function(e,t){this.hideTopMessage(),this.showTopMessage(e,t,"information")},showSuccessMessage:function(e,t){this.hideTopMessage(),e=e||ExposeTranslation.get("message.success"),this.showTopMessage(e,t,"success")}});return new r}),define("views/includes/app_user_profile",["jQuery","Underscore","Backbone","helpers/template_manager","event_manager","app_user","helpers/assets"],function(e,t,n,r,i,s,o){var u=n.View.extend({initialize:function(){this.render(),this.$el.attr("id","account_info"),this.$el.attr("class","clearfix")},template:t.template(r.getAppUserProfileTemplate()),events:{"click p.user":"showUser","click p.user_name":"showUser"},render:function(){return this.$el.html(this.template(o.wrapAssetics({appUser:s.toJSON()}))),this},showUser:function(e){e.preventDefault(),i.trigger("changePage","user",{username:s.get("username")})}});return new u}),define("views/includes/welcome",["jQuery","Underscore","Backbone","event_manager"],function(e,t,n,r){var i=n.View.extend({el:"div#welcome",events:{"click .next":"nextPopup","click .finish":"finishGuidance"},initialize:function(){r.on("loaded",this.closeAllPopups(),this);var t=e("#main_calendar td.today");if(t.length===0){this.$("#ewp").remove();var n=this.$(".popup").last();n.find(".next").remove(),n.find(".finish").text(ExposeTranslation.get("button.close"))}else{var i=t.offset();this.$("#ewp").css({left:i.left-90,top:i.top-100,right:"auto"})}this.showFirstPopup()},showFirstPopup:function(){this.$(".popup").first().fadeIn("fast")},nextPopup:function(){var e=this.$(".popup").filter(":visible").next();this.closeAllPopups(),e.fadeIn("fast")},finishGuidance:function(){this.closeAllPopups(),e.ajax({type:"POST",url:Routing.generate("droppy_user_ajax_set_started")})},closeAllPopups:function(){this.$(".popup").fadeOut("fast")}});return i}),define("app",["jQuery","Underscore","Backbone","router","model/user","data_manager","views/top_message","event_manager","app_user","views/includes/app_user_profile","views/includes/welcome"],function(e,t,n,r,i,s,o,u,a,f,l){var c=n.View.extend({initialize:function(){this.loading=0,this.dataManager=new s,this.topMessageView=o,this.initEvents(),e(window).resize(this.resize),this.router=r.initialize(),a.get("hasStarted")||new l,this.$("div#left").prepend(f.el)},initEvents:function(){u.on("changePage",this.changePage,this),u.on("loading",this.setLoading,this),u.on("endLoading",this.endLoading,this),u.on("back",this.back,this),u.on("loaded",this.showPage,this),u.on("pageChanged",this.pageChanged,this),u.on("success",this.success,this)},el:e("div#wrapper"),events:{"click div.logo":"toTop","click div.home a":"toTop","click div.make_event a":"eventCreation","click div.recommend a":"recommendations","click div.pulldown":"showMenu","keyup input.search_txt":"makeSearch","click #account_info":"showUser"},isLoading:function(){return this.loading},success:function(e){this.topMessageView.showSuccessMessage(e)},showUser:function(e){e.preventDefault(),this.changePage("user",{username:a.get("username")})},toTop:function(e){e.preventDefault(),this.changePage(this.router.generateRoute("top"))},setLoading:function(){if(this.loading===0){var e=ExposeTranslation.get("common.loading");this.topMessageView.showInformationMessage(e,-1)}this.loading++},endLoading:function(){this.loading--,this.loading<0&&(this.loading=0),this.loading===0&&this.topMessageView.hideLoading()},makeSearch:function(t){var n=t.which||t.keycode,r=e(t.target);n==13&&(this.changePage("search",{keyword:r.val()}),r.val(""),r.blur())},changePage:function(e,t){var n=this.router.generateRoute(e,t);if("#"+n===window.location.hash)return;this.router.navigate(n,{trigger:!0})},eventCreation:function(e){e.preventDefault(),this.changePage("event_creation")},recommendations:function(e){e.preventDefault(),this.changePage("recommendations")},showMenu:function(t){e("#pulldown_items").not(":animated").slideToggle("fast")},back:function(){window.history.back()},showPage:function(e){if(!e.loaded){var t=e.render().el;this.$("div#main").prepend(t)}this.$("div#main").children("div").hide(),e.show(),this.resize()},pageChanged:function(e,t){this.resize(),this.router.navigate(this.router.generateRoute(e,t))},resize:function(){var t=document.documentElement.clientHeight||document.body.clientHeight||document.body.scrollHeight;e("div#timeline").height(t-125-35),e("#col2_content .recommended_users").find("div").each(function(){e(this).show();if(e(this).offset().top+100>t)return e(this).nextAll().hide(),!1}),e("#user").height(t-35),e("div.search").height(t-35),u.trigger("resize")}}),h=function(){n.emulateHTTP=!0,new c};return{initialize:h}}),typeof Array.isArray=="undefined"&&(Array.isArray=function(e){return e instanceof Array}),String.prototype.capitalize=function(){return this.charAt(0).toUpperCase()+this.slice(1)},String.prototype.fromCamelCase=function(){var e=[],t=0;for(var n in this){if(!this.hasOwnProperty(n))continue;this[n]>="A"&&this[n]<="Z"&&(e.push(this.substring(t,n).toLowerCase()),t=parseInt(n))}return e.push(this.substring(t).toLowerCase()),e.join("_")},String.prototype.toCamelCase=function(){var e=this.split("_"),t=function(e){return e.capitalize()},n=e[0],r=e.slice(1);for(var i in r)n+=r[i].capitalize();return n},String.prototype.urlify=function(){var e=/(\b(https?|ftp|file):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/ig;return this.replace(e,'<a href="$1">$1</a>')},String.prototype.nl2br=function(){return this.replace(/\n/g,"<br />\n")},Object.changeKeys=function(e,t){var n={};for(var r in t){if(!t.hasOwnProperty(r))continue;typeof t[r]=="object"&&t[r]!==null&&!Array.isArray(t[r])?n[e(r)]=Object.changeKeys(e,t[r]):n[e(r)]=t[r]}return n},Object.keysToCamelCase=function(e){return Object.changeKeys(function(e){return e.toCamelCase()},e)},Object.keysFromCamelCase=function(e){return Object.changeKeys(function(e){return e.fromCamelCase()},e)},define("helpers/objects_extension",function(){}),Date.prototype.dateEquals=function(e){return this.getFullYear()===e.getFullYear()&&this.getMonth()===e.getMonth()&&this.getDate()===e.getDate()},Date.prototype.sameMonth=function(e){return this.getFullYear()===e.getFullYear()&&this.getMonth()===e.getMonth()},Date.prototype.getCategory=function(){var e=window.firstDayOfWeek||0,t=new Date;if(this.dateEquals(t))return"today";t.setDate(t.getDate()+1);if(this.dateEquals(t))return"tomorrow";do{if(this.dateEquals(t))return"this_week";t.setDate(t.getDate()+1)}while(t.getDay()!=e);return this.sameMonth(t)?"this_month":"after_this_month"},Date.getToday=function(){var e=new Date;return e.setHours(0,0,0,0),e},Date.preZero=function(e){return parseInt(e)<10?"0"+e:e},Date.prototype.format=function(e){var t="";for(var n=0;n<e.length;n++){var r=e.charAt(n);switch(r){case"Y":t+=this.getFullYear();break;case"y":t+=this.getFullYear().toString().substr(2,2);break;case"m":t+=Date.preZero(this.getMonth()+1);break;case"n":t+=this.getMonth()+1;break;case"F":t+=this.getMonthName();break;case"M":t+=this.getMonthName().substr(0,3);break;case"d":t+=Date.preZero(this.getDate());break;case"j":t+=this.getDate();break;case"l":t+=this.getDayName();break;case"D":t+=this.getDayName().substr(0,3);break;case"H":t+=Date.preZero(this.getHours());break;case"i":t+=Date.preZero(this.getMinutes());break;default:t+=r}}return t},Date.prototype.firstDateToDisplay=function(e){var t=new Date(this);e=e||0,t.setDate(1);while(t.getDay()!=e)t.setDate(t.getDate()-1);return t.setHours(0,0,0,0),t},Date.prototype.lastDateToDisplay=function(e){var t=new Date(this);e=e||0,t.setMonth(t.getMonth()+1,0);while(t.getDay()!=e)t.setDate(t.getDate()+1);return t.setDate(t.getDate()-1),t.setHours(23,59,59,999),t},Date.prototype.getDaysDifference=function(e){var t=(new Date(this)).setHours(0,0,0,0),n=(new Date(e)).setHours(0,0,0,0),r=Math.abs(t-n),i=864e5;return r/i+1},Date.prototype.getClassName=function(e){var t=Date.getToday(),n="";return this.sameMonth(e)||(n+="gray "),this<t&&(n+="passed "),this.dateEquals(t)&&(n+="today"),n},Date.prototype.daysToDisplay=function(e){e=e||0;var t=this.firstDateToDisplay(e),n=this.lastDateToDisplay(e);return n.getDaysDifference(t)},Date.prototype.getDayName=function(){var e=["sun","mon","tue","wed","thu","fri","sat"];return ExposeTranslation.get("time.day_of_week."+e[this.getDay()])},Date.prototype.getMonthName=function(){var e=["jan","feb","mar","apr","may","jun","jul","aug","sep","oct","nov","dec"];return ExposeTranslation.get("time.months."+e[this.getMonth()])},Date.prototype.fromFirstDayOfWeek=function(e){return e=e||0,(this.getDay()-e+7)%7},Date.prototype.toLastDayOfWeek=function(e){return e=e||0,7-this.fromFirstDayOfWeek()},Date.prototype.rowsFromFirstDisplayedDay=function(e,t){e=e||0,t=t||this;var n=new Date(t.firstDateToDisplay(e));for(var r=0;r<6;r++){n.setDate(n.getDate()+7);if(this<n)return r}},Date.getCurrent=function(){var e=new Date;return e.getMinutes()<=30?e.setMinutes(30,0,0):e.setHours(e.getHours()+1,0,0,0),e},Date.getNextHour=function(){var e=Date.getCurrent();return e.setHours(e.getHours()+1),e},Date.prototype.getYearFromZero=function(){return this.getFullYear()-1970},define("helpers/date_extension",function(){}),require.config({baseUrl:"js",paths:{tpl:"libs/tpl/tpl",order:"libs/requirejs-plugins/order",text:"libs/requirejs-plugins/text",jQuery:"libs/jquery/jquery",Underscore:"libs/underscore/underscore",Backbone:"libs/backbone/backbone-amd",templates:"../templates",Sync:"helpers/sync"}}),require(["app","helpers/objects_extension","helpers/date_extension"],function(e){e.initialize()}),define("main",function(){});